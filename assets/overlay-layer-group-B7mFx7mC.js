import{aF as ke,aG as xn,aH as yn,o as Wt,w as ni,J as si,aI as mn,aJ as ut,aK as Vt,aL as rt,aM as ot,aN as Ht,aO as jt,aP as Zt,am as ee,aQ as Sn,al as qe,aR as H,aS as Jt,aT as En,aU as j,i as st,aV as _t,aW as zt,aX as kt,aY as Xi,aZ as Cn,ag as N,r as In,a_ as Ot,a$ as bn,b0 as Tn,b1 as ie,b2 as vt,a as Oe,ap as xt,b3 as Rn,b4 as mt,b5 as vn,b6 as ri,b7 as $t,b8 as wn,b9 as qt,ba as Qt,bb as Fn,a8 as Ln,bc as kn,bd as On,a9 as oi,be as Lt,bf as An,bg as Bt,bh as wt,bi as Ae,bj as Dn,bk as ai,bl as li,aj as Mn,bm as Ft,bn as Pn,bo as Gn,ak as Wn,bp as Bn,bq as Yn,u as De,l as Me,E as Ni,br as Kt,bs as qi,bt as Xn,af as Nn,h as qn,bu as Kn,bv as Un,K as Vn,j as Ki,bw as Hn,bx as jn,by as Zn,x as Jn,p as zn,bz as $n,bA as Ui,bB as Qn,bC as ts,ad as es,bD as is,ae as hi,bE as ns,V as ss,a7 as rs,bF as os,bG as as,bH as ne,bI as ls,bJ as hs,bK as cs,bL as us,g as Vi,bM as Hi,bN as ds,aE as Yt}from"./background-layer-group-DBG8TuQL.js";class ji{drawCustom(t,e,i,n,s){}drawGeometry(t){}setStyle(t){}drawCircle(t,e,i){}drawFeature(t,e,i){}drawGeometryCollection(t,e,i){}drawLineString(t,e,i){}drawMultiLineString(t,e,i){}drawMultiPoint(t,e,i){}drawMultiPolygon(t,e,i){}drawPoint(t,e,i){}drawPolygon(t,e,i){}drawText(t,e,i){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}}const I={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},Xt=[I.FILL],dt=[I.STROKE],pt=[I.BEGIN_PATH],ci=[I.CLOSE_PATH];class At extends ji{constructor(t,e,i,n){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=n,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const e=this.pixelRatio;return e==1?t:t.map(function(i){return i*e})}appendFlatPointCoordinates(t,e){const i=this.getBufferedMaxExtent(),n=this.tmpCoordinate_,s=this.coordinates;let r=s.length;for(let o=0,l=t.length;o<l;o+=e)n[0]=t[o],n[1]=t[o+1],ke(i,n)&&(s[r++]=n[0],s[r++]=n[1]);return r}appendFlatLineCoordinates(t,e,i,n,s,r){const o=this.coordinates;let l=o.length;const c=this.getBufferedMaxExtent();r&&(e+=n);let h=t[e],u=t[e+1];const d=this.tmpCoordinate_;let f=!0,p,g,_;for(p=e+n;p<i;p+=n)d[0]=t[p],d[1]=t[p+1],_=xn(c,d),_!==g?(f&&(o[l++]=h,o[l++]=u,f=!1),o[l++]=d[0],o[l++]=d[1]):_===yn.INTERSECTING?(o[l++]=d[0],o[l++]=d[1],f=!1):f=!0,h=d[0],u=d[1],g=_;return(s&&f||p===e+n)&&(o[l++]=h,o[l++]=u),l}drawCustomCoordinates_(t,e,i,n,s){for(let r=0,o=i.length;r<o;++r){const l=i[r],c=this.appendFlatLineCoordinates(t,e,l,n,!1,!1);s.push(c),e=l}return e}drawCustom(t,e,i,n,s){this.beginGeometry(t,e,s);const r=t.getType(),o=t.getStride(),l=this.coordinates.length;let c,h,u,d,f;switch(r){case"MultiPolygon":c=t.getOrientedFlatCoordinates(),d=[];const p=t.getEndss();f=0;for(let g=0,_=p.length;g<_;++g){const x=[];f=this.drawCustomCoordinates_(c,f,p[g],o,x),d.push(x)}this.instructions.push([I.CUSTOM,l,d,t,i,si,s]),this.hitDetectionInstructions.push([I.CUSTOM,l,d,t,n||i,si,s]);break;case"Polygon":case"MultiLineString":u=[],c=r=="Polygon"?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),f=this.drawCustomCoordinates_(c,0,t.getEnds(),o,u),this.instructions.push([I.CUSTOM,l,u,t,i,ni,s]),this.hitDetectionInstructions.push([I.CUSTOM,l,u,t,n||i,ni,s]);break;case"LineString":case"Circle":c=t.getFlatCoordinates(),h=this.appendFlatLineCoordinates(c,0,c.length,o,!1,!1),this.instructions.push([I.CUSTOM,l,h,t,i,Wt,s]),this.hitDetectionInstructions.push([I.CUSTOM,l,h,t,n||i,Wt,s]);break;case"MultiPoint":c=t.getFlatCoordinates(),h=this.appendFlatPointCoordinates(c,o),h>l&&(this.instructions.push([I.CUSTOM,l,h,t,i,Wt,s]),this.hitDetectionInstructions.push([I.CUSTOM,l,h,t,n||i,Wt,s]));break;case"Point":c=t.getFlatCoordinates(),this.coordinates.push(c[0],c[1]),h=this.coordinates.length,this.instructions.push([I.CUSTOM,l,h,t,i,void 0,s]),this.hitDetectionInstructions.push([I.CUSTOM,l,h,t,n||i,void 0,s]);break}this.endGeometry(e)}beginGeometry(t,e,i){this.beginGeometryInstruction1_=[I.BEGIN_GEOMETRY,e,0,t,i],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[I.BEGIN_GEOMETRY,e,0,t,i],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;t.reverse();let e;const i=t.length;let n,s,r=-1;for(e=0;e<i;++e)n=t[e],s=n[0],s==I.END_GEOMETRY?r=e:s==I.BEGIN_GEOMETRY&&(n[2]=e,mn(this.hitDetectionInstructions,r,e),r=-1)}fillStyleToState(t,e={}){if(t){const i=t.getColor();e.fillPatternScale=i&&typeof i=="object"&&"src"in i?this.pixelRatio:1,e.fillStyle=ut(i||H)}else e.fillStyle=void 0;return e}strokeStyleToState(t,e={}){if(t){const i=t.getColor();e.strokeStyle=ut(i||Jt);const n=t.getLineCap();e.lineCap=n!==void 0?n:Vt;const s=t.getLineDash();e.lineDash=s?s.slice():rt;const r=t.getLineDashOffset();e.lineDashOffset=r||ot;const o=t.getLineJoin();e.lineJoin=o!==void 0?o:Ht;const l=t.getWidth();e.lineWidth=l!==void 0?l:jt;const c=t.getMiterLimit();e.miterLimit=c!==void 0?c:Zt,e.lineWidth>this.maxLineWidth&&(this.maxLineWidth=e.lineWidth,this.bufferedMaxExtent_=null)}else e.strokeStyle=void 0,e.lineCap=void 0,e.lineDash=null,e.lineDashOffset=void 0,e.lineJoin=void 0,e.lineWidth=void 0,e.miterLimit=void 0;return e}setFillStrokeStyle(t,e){const i=this.state;this.fillStyleToState(t,i),this.strokeStyleToState(e,i)}createFill(t){const e=t.fillStyle,i=[I.SET_FILL_STYLE,e];return typeof e!="string"&&i.push(t.fillPatternScale),i}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[I.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,t.lineDash?this.applyPixelRatio(t.lineDash):null,t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){const i=t.fillStyle;(typeof i!="string"||t.currentFillStyle!=i)&&(this.instructions.push(e.call(this,t)),t.currentFillStyle=i)}updateStrokeStyle(t,e){const i=t.strokeStyle,n=t.lineCap,s=t.lineDash,r=t.lineDashOffset,o=t.lineJoin,l=t.lineWidth,c=t.miterLimit;(t.currentStrokeStyle!=i||t.currentLineCap!=n||s!=t.currentLineDash&&!ee(t.currentLineDash,s)||t.currentLineDashOffset!=r||t.currentLineJoin!=o||t.currentLineWidth!=l||t.currentMiterLimit!=c)&&(e.call(this,t),t.currentStrokeStyle=i,t.currentLineCap=n,t.currentLineDash=s,t.currentLineDashOffset=r,t.currentLineJoin=o,t.currentLineWidth=l,t.currentMiterLimit=c)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const e=[I.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=Sn(this.maxExtent),this.maxLineWidth>0)){const t=this.resolution*(this.maxLineWidth+1)/2;qe(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class fs extends At{constructor(t,e,i,n){super(t,e,i,n),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e,i){if(!this.image_||this.maxExtent&&!ke(this.maxExtent,t.getFlatCoordinates()))return;this.beginGeometry(t,e,i);const n=t.getFlatCoordinates(),s=t.getStride(),r=this.coordinates.length,o=this.appendFlatPointCoordinates(n,s);this.instructions.push([I.DRAW_IMAGE,r,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([I.DRAW_IMAGE,r,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(t,e,i){if(!this.image_)return;this.beginGeometry(t,e,i);const n=t.getFlatCoordinates(),s=[];for(let l=0,c=n.length;l<c;l+=t.getStride())(!this.maxExtent||ke(this.maxExtent,n.slice(l,l+2)))&&s.push(n[l],n[l+1]);const r=this.coordinates.length,o=this.appendFlatPointCoordinates(s,2);this.instructions.push([I.DRAW_IMAGE,r,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([I.DRAW_IMAGE,r,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){const i=t.getAnchor(),n=t.getSize(),s=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=n[1],this.opacity_=t.getOpacity(),this.originX_=s[0],this.originY_=s[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=n[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}class gs extends At{constructor(t,e,i,n){super(t,e,i,n)}drawFlatCoordinates_(t,e,i,n){const s=this.coordinates.length,r=this.appendFlatLineCoordinates(t,e,i,n,!1,!1),o=[I.MOVE_TO_LINE_TO,s,r];return this.instructions.push(o),this.hitDetectionInstructions.push(o),i}drawLineString(t,e,i){const n=this.state,s=n.strokeStyle,r=n.lineWidth;if(s===void 0||r===void 0)return;this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(t,e,i),this.hitDetectionInstructions.push([I.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,rt,ot],pt);const o=t.getFlatCoordinates(),l=t.getStride();this.drawFlatCoordinates_(o,0,o.length,l),this.hitDetectionInstructions.push(dt),this.endGeometry(e)}drawMultiLineString(t,e,i){const n=this.state,s=n.strokeStyle,r=n.lineWidth;if(s===void 0||r===void 0)return;this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(t,e,i),this.hitDetectionInstructions.push([I.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,rt,ot],pt);const o=t.getEnds(),l=t.getFlatCoordinates(),c=t.getStride();let h=0;for(let u=0,d=o.length;u<d;++u)h=this.drawFlatCoordinates_(l,h,o[u],c);this.hitDetectionInstructions.push(dt),this.endGeometry(e)}finish(){const t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(dt),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(dt),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(pt)}}class ui extends At{constructor(t,e,i,n){super(t,e,i,n)}drawFlatCoordinatess_(t,e,i,n){const s=this.state,r=s.fillStyle!==void 0,o=s.strokeStyle!==void 0,l=i.length;this.instructions.push(pt),this.hitDetectionInstructions.push(pt);for(let c=0;c<l;++c){const h=i[c],u=this.coordinates.length,d=this.appendFlatLineCoordinates(t,e,h,n,!0,!o),f=[I.MOVE_TO_LINE_TO,u,d];this.instructions.push(f),this.hitDetectionInstructions.push(f),o&&(this.instructions.push(ci),this.hitDetectionInstructions.push(ci)),e=h}return r&&(this.instructions.push(Xt),this.hitDetectionInstructions.push(Xt)),o&&(this.instructions.push(dt),this.hitDetectionInstructions.push(dt)),e}drawCircle(t,e,i){const n=this.state,s=n.fillStyle,r=n.strokeStyle;if(s===void 0&&r===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([I.SET_FILL_STYLE,H]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([I.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,rt,ot]);const o=t.getFlatCoordinates(),l=t.getStride(),c=this.coordinates.length;this.appendFlatLineCoordinates(o,0,o.length,l,!1,!1);const h=[I.CIRCLE,c];this.instructions.push(pt,h),this.hitDetectionInstructions.push(pt,h),n.fillStyle!==void 0&&(this.instructions.push(Xt),this.hitDetectionInstructions.push(Xt)),n.strokeStyle!==void 0&&(this.instructions.push(dt),this.hitDetectionInstructions.push(dt)),this.endGeometry(e)}drawPolygon(t,e,i){const n=this.state,s=n.fillStyle,r=n.strokeStyle;if(s===void 0&&r===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([I.SET_FILL_STYLE,H]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([I.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,rt,ot]);const o=t.getEnds(),l=t.getOrientedFlatCoordinates(),c=t.getStride();this.drawFlatCoordinatess_(l,0,o,c),this.endGeometry(e)}drawMultiPolygon(t,e,i){const n=this.state,s=n.fillStyle,r=n.strokeStyle;if(s===void 0&&r===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([I.SET_FILL_STYLE,H]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([I.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,rt,ot]);const o=t.getEndss(),l=t.getOrientedFlatCoordinates(),c=t.getStride();let h=0;for(let u=0,d=o.length;u<d;++u)h=this.drawFlatCoordinatess_(l,h,o[u],c);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(t!==0){const e=this.coordinates;for(let i=0,n=e.length;i<n;++i)e[i]=En(e[i],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;this.updateFillStyle(t,this.createFill),this.updateStrokeStyle(t,this.applyStroke)}}function _s(a,t,e,i,n){const s=[];let r=e,o=0,l=t.slice(e,2);for(;o<a&&r+n<i;){const[c,h]=l.slice(-2),u=t[r+n],d=t[r+n+1],f=Math.sqrt((u-c)*(u-c)+(d-h)*(d-h));if(o+=f,o>=a){const p=(a-o+f)/f,g=j(c,u,p),_=j(h,d,p);l.push(g,_),s.push(l),l=[g,_],o==a&&(r+=n),o=0}else if(o<a)l.push(t[r+n],t[r+n+1]),r+=n;else{const p=f-o,g=j(c,u,p/f),_=j(h,d,p/f);l.push(g,_),s.push(l),l=[g,_],o=0,r+=n}}return o>0&&s.push(l),s}function ps(a,t,e,i,n){let s=e,r=e,o=0,l=0,c=e,h,u,d,f,p,g,_,x,S,E;for(u=e;u<i;u+=n){const y=t[u],C=t[u+1];p!==void 0&&(S=y-p,E=C-g,f=Math.sqrt(S*S+E*E),_!==void 0&&(l+=d,h=Math.acos((_*S+x*E)/(d*f)),h>a&&(l>o&&(o=l,s=c,r=u),l=0,c=u-n)),d=f,_=S,x=E),p=y,g=C}return l+=f,l>o?[c,u]:[s,r]}const te={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class xs extends At{constructor(t,e,i,n){super(t,e,i,n),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textKeepUpright_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[H]={fillStyle:H},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e,i){const n=this.textFillState_,s=this.textStrokeState_,r=this.textState_;if(this.text_===""||!r||!n&&!s)return;const o=this.coordinates;let l=o.length;const c=t.getType();let h=null,u=t.getStride();if(r.placement==="line"&&(c=="LineString"||c=="MultiLineString"||c=="Polygon"||c=="MultiPolygon")){if(!st(this.maxExtent,t.getExtent()))return;let d;if(h=t.getFlatCoordinates(),c=="LineString")d=[h.length];else if(c=="MultiLineString")d=t.getEnds();else if(c=="Polygon")d=t.getEnds().slice(0,1);else if(c=="MultiPolygon"){const _=t.getEndss();d=[];for(let x=0,S=_.length;x<S;++x)d.push(_[x][0])}this.beginGeometry(t,e,i);const f=r.repeat,p=f?void 0:r.textAlign;let g=0;for(let _=0,x=d.length;_<x;++_){let S;f?S=_s(f*this.resolution,h,g,d[_],u):S=[h.slice(g,d[_])];for(let E=0,y=S.length;E<y;++E){const C=S[E];let b=0,T=C.length;if(p==null){const R=ps(r.maxAngle,C,0,C.length,2);b=R[0],T=R[1]}for(let R=b;R<T;R+=u)o.push(C[R],C[R+1]);const w=o.length;g=d[_],this.drawChars_(l,w),l=w}}this.endGeometry(e)}else{let d=r.overflow?null:[];switch(c){case"Point":case"MultiPoint":h=t.getFlatCoordinates();break;case"LineString":h=t.getFlatMidpoint();break;case"Circle":h=t.getCenter();break;case"MultiLineString":h=t.getFlatMidpoints(),u=2;break;case"Polygon":h=t.getFlatInteriorPoint(),r.overflow||d.push(h[2]/this.resolution),u=3;break;case"MultiPolygon":const y=t.getFlatInteriorPoints();h=[];for(let C=0,b=y.length;C<b;C+=3)r.overflow||d.push(y[C+2]/this.resolution),h.push(y[C],y[C+1]);if(h.length===0)return;u=2;break}const f=this.appendFlatPointCoordinates(h,u);if(f===l)return;if(d&&(f-l)/2!==h.length/u){let y=l/2;d=d.filter((C,b)=>{const T=o[(y+b)*2]===h[b*u]&&o[(y+b)*2+1]===h[b*u+1];return T||--y,T})}this.saveTextStates_();const p=r.backgroundFill?this.createFill(this.fillStyleToState(r.backgroundFill)):null,g=r.backgroundStroke?this.createStroke(this.strokeStyleToState(r.backgroundStroke)):null;this.beginGeometry(t,e,i);let _=r.padding;if(_!=_t&&(r.scale[0]<0||r.scale[1]<0)){let y=r.padding[0],C=r.padding[1],b=r.padding[2],T=r.padding[3];r.scale[0]<0&&(C=-C,T=-T),r.scale[1]<0&&(y=-y,b=-b),_=[y,C,b,T]}const x=this.pixelRatio;this.instructions.push([I.DRAW_IMAGE,l,f,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,_==_t?_t:_.map(function(y){return y*x}),p,g,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,d]);const S=1/x,E=p?p.slice(0):null;E&&(E[1]=H),this.hitDetectionInstructions.push([I.DRAW_IMAGE,l,f,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[S,S],NaN,this.declutterMode_,this.declutterImageWithText_,_,E,g,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?H:this.fillKey_,this.textOffsetX_,this.textOffsetY_,d]),this.endGeometry(e)}}saveTextStates_(){const t=this.textStrokeState_,e=this.textState_,i=this.textFillState_,n=this.strokeKey_;t&&(n in this.strokeStates||(this.strokeStates[n]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));const s=this.textKey_;s in this.textStates||(this.textStates[s]={font:e.font,textAlign:e.textAlign||kt,justify:e.justify,textBaseline:e.textBaseline||zt,scale:e.scale});const r=this.fillKey_;i&&(r in this.fillStates||(this.fillStates[r]={fillStyle:i.fillStyle}))}drawChars_(t,e){const i=this.textStrokeState_,n=this.textState_,s=this.strokeKey_,r=this.textKey_,o=this.fillKey_;this.saveTextStates_();const l=this.pixelRatio,c=te[n.textBaseline],h=this.textOffsetY_*l,u=this.text_,d=i?i.lineWidth*Math.abs(n.scale[0])/2:0;this.instructions.push([I.DRAW_CHARS,t,e,c,n.overflow,o,n.maxAngle,l,h,s,d*l,u,r,1,this.declutterMode_,this.textKeepUpright_]),this.hitDetectionInstructions.push([I.DRAW_CHARS,t,e,c,n.overflow,o&&H,n.maxAngle,l,h,s,d*l,u,r,1/l,this.declutterMode_,this.textKeepUpright_])}setTextStyle(t,e){let i,n,s;if(!t)this.text_="";else{const r=t.getFill();r?(n=this.textFillState_,n||(n={},this.textFillState_=n),n.fillStyle=ut(r.getColor()||H)):(n=null,this.textFillState_=n);const o=t.getStroke();if(!o)s=null,this.textStrokeState_=s;else{s=this.textStrokeState_,s||(s={},this.textStrokeState_=s);const g=o.getLineDash(),_=o.getLineDashOffset(),x=o.getWidth(),S=o.getMiterLimit();s.lineCap=o.getLineCap()||Vt,s.lineDash=g?g.slice():rt,s.lineDashOffset=_===void 0?ot:_,s.lineJoin=o.getLineJoin()||Ht,s.lineWidth=x===void 0?jt:x,s.miterLimit=S===void 0?Zt:S,s.strokeStyle=ut(o.getColor()||Jt)}i=this.textState_;const l=t.getFont()||Xi;Cn(l);const c=t.getScaleArray();i.overflow=t.getOverflow(),i.font=l,i.maxAngle=t.getMaxAngle(),i.placement=t.getPlacement(),i.textAlign=t.getTextAlign(),i.repeat=t.getRepeat(),i.justify=t.getJustify(),i.textBaseline=t.getTextBaseline()||zt,i.backgroundFill=t.getBackgroundFill(),i.backgroundStroke=t.getBackgroundStroke(),i.padding=t.getPadding()||_t,i.scale=c===void 0?[1,1]:c;const h=t.getOffsetX(),u=t.getOffsetY(),d=t.getRotateWithView(),f=t.getKeepUpright(),p=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=h===void 0?0:h,this.textOffsetY_=u===void 0?0:u,this.textRotateWithView_=d===void 0?!1:d,this.textKeepUpright_=f===void 0?!0:f,this.textRotation_=p===void 0?0:p,this.strokeKey_=s?(typeof s.strokeStyle=="string"?s.strokeStyle:N(s.strokeStyle))+s.lineCap+s.lineDashOffset+"|"+s.lineWidth+s.lineJoin+s.miterLimit+"["+s.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.repeat||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=n&&n.fillStyle?typeof n.fillStyle=="string"?n.fillStyle:"|"+N(n.fillStyle):""}this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}const ys={Circle:ui,Default:At,Image:fs,LineString:gs,Polygon:ui,Text:xs};class ms{constructor(t,e,i,n){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=n,this.resolution_=i,this.buildersByZIndex_={}}finish(){const t={};for(const e in this.buildersByZIndex_){t[e]=t[e]||{};const i=this.buildersByZIndex_[e];for(const n in i){const s=i[n].finish();t[e][n]=s}}return t}getBuilder(t,e){const i=t!==void 0?t.toString():"0";let n=this.buildersByZIndex_[i];n===void 0&&(n={},this.buildersByZIndex_[i]=n);let s=n[e];if(s===void 0){const r=ys[e];s=new r(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),n[e]=s}return s}}function Ss(a,t,e,i){let n=a[t],s=a[t+1],r=0;for(let o=t+i;o<e;o+=i){const l=a[o],c=a[o+1];r+=Math.sqrt((l-n)*(l-n)+(c-s)*(c-s)),n=l,s=c}return r}function Es(a,t,e,i,n,s,r,o,l,c,h,u,d=!0){let f=a[t],p=a[t+1],g=0,_=0,x=0,S=0;function E(){g=f,_=p,t+=i,f=a[t],p=a[t+1],S+=x,x=Math.sqrt((f-g)*(f-g)+(p-_)*(p-_))}do E();while(t<e-i&&S+x<s);let y=x===0?0:(s-S)/x;const C=j(g,f,y),b=j(_,p,y),T=t-i,w=S,R=s+o*l(c,n,h);for(;t<e-i&&S+x<R;)E();y=x===0?0:(R-S)/x;const M=j(g,f,y),A=j(_,p,y);let L=!1;if(d)if(u){const k=[C,b,M,A];In(k,0,4,2,u,k,k),L=k[0]>k[2]}else L=C>M;const D=Math.PI,F=[],W=T+i===t;t=T,x=0,S=w,f=a[t],p=a[t+1];let v;if(W){E(),v=Math.atan2(p-_,f-g),L&&(v+=v>0?-D:D);const k=(M+C)/2,O=(A+b)/2;return F[0]=[k,O,(R-s)/2,v,n],F}n=n.replace(/\n/g," ");for(let k=0,O=n.length;k<O;){E();let Y=Math.atan2(p-_,f-g);if(L&&(Y+=Y>0?-D:D),v!==void 0){let J=Y-v;if(J+=J>D?-2*D:J<-D?2*D:0,Math.abs(J)>r)return null}v=Y;const P=k;let B=0;for(;k<O;++k){const J=L?O-k-1:k,Dt=o*l(c,n[J],h);if(t+i<e&&S+x<s+B+Dt/2)break;B+=Dt}if(k===P)continue;const m=L?n.substring(O-P,O-k):n.substring(P,k);y=x===0?0:(s+B/2-S)/x;const St=j(g,f,y),Et=j(_,p,y);F.push([St,Et,B/2,Y,m]),s+=B}return F}const yt=xt(),lt=[],it=[],nt=[],ht=[];function di(a){return a[3].declutterBox}const fi=new RegExp("[֑-ࣿיִ-﷿ﹰ-ﻼࠀ-࿿-]");function fe(a,t){return t==="start"?t=fi.test(a)?"right":"left":t==="end"&&(t=fi.test(a)?"left":"right"),te[t]}function Cs(a,t,e){return e>0&&a.push(`
`,""),a.push(t,""),a}function Is(a,t,e){return e%2===0&&(a+=t),a}class bs{constructor(t,e,i,n,s){this.overlaps=i,this.pixelRatio=e,this.resolution=t,this.alignAndScaleFill_,this.instructions=n.instructions,this.coordinates=n.coordinates,this.coordinateCache_={},this.renderedTransform_=Ot(),this.hitDetectionInstructions=n.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=n.fillStates||{},this.strokeStates=n.strokeStates||{},this.textStates=n.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=s?new bn:null}getZIndexContext(){return this.zIndexContext_}createLabel(t,e,i,n){const s=t+e+i+n;if(this.labels_[s])return this.labels_[s];const r=n?this.strokeStates[n]:null,o=i?this.fillStates[i]:null,l=this.textStates[e],c=this.pixelRatio,h=[l.scale[0]*c,l.scale[1]*c],u=l.justify?te[l.justify]:fe(Array.isArray(t)?t[0]:t,l.textAlign||kt),d=n&&r.lineWidth?r.lineWidth:0,f=Array.isArray(t)?t:String(t).split(`
`).reduce(Cs,[]),{width:p,height:g,widths:_,heights:x,lineWidths:S}=Tn(l,f),E=p+d,y=[],C=(E+2)*h[0],b=(g+d)*h[1],T={width:C<0?Math.floor(C):Math.ceil(C),height:b<0?Math.floor(b):Math.ceil(b),contextInstructions:y};(h[0]!=1||h[1]!=1)&&y.push("scale",h),n&&(y.push("strokeStyle",r.strokeStyle),y.push("lineWidth",d),y.push("lineCap",r.lineCap),y.push("lineJoin",r.lineJoin),y.push("miterLimit",r.miterLimit),y.push("setLineDash",[r.lineDash]),y.push("lineDashOffset",r.lineDashOffset)),i&&y.push("fillStyle",o.fillStyle),y.push("textBaseline","middle"),y.push("textAlign","center");const w=.5-u;let R=u*E+w*d;const M=[],A=[];let L=0,D=0,F=0,W=0,v;for(let k=0,O=f.length;k<O;k+=2){const Y=f[k];if(Y===`
`){D+=L,L=0,R=u*E+w*d,++W;continue}const P=f[k+1]||l.font;P!==v&&(n&&M.push("font",P),i&&A.push("font",P),v=P),L=Math.max(L,x[F]);const B=[Y,R+w*_[F]+u*(_[F]-S[W]),.5*(d+L)+D];R+=_[F],n&&M.push("strokeText",B),i&&A.push("fillText",B),++F}return Array.prototype.push.apply(y,M),Array.prototype.push.apply(y,A),this.labels_[s]=T,T}replayTextBackground_(t,e,i,n,s,r,o){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,i),t.lineTo.apply(t,n),t.lineTo.apply(t,s),t.lineTo.apply(t,e),r&&(this.alignAndScaleFill_=r[2],t.fillStyle=r[1],this.fill_(t)),o&&(this.setStrokeStyle_(t,o),t.stroke())}calculateImageOrLabelDimensions_(t,e,i,n,s,r,o,l,c,h,u,d,f,p,g,_){o*=d[0],l*=d[1];let x=i-o,S=n-l;const E=s+c>t?t-c:s,y=r+h>e?e-h:r,C=p[3]+E*d[0]+p[1],b=p[0]+y*d[1]+p[2],T=x-p[3],w=S-p[0];(g||u!==0)&&(lt[0]=T,ht[0]=T,lt[1]=w,it[1]=w,it[0]=T+C,nt[0]=it[0],nt[1]=w+b,ht[1]=nt[1]);let R;return u!==0?(R=ie(Ot(),i,n,1,1,u,-i,-n),vt(R,lt),vt(R,it),vt(R,nt),vt(R,ht),Oe(Math.min(lt[0],it[0],nt[0],ht[0]),Math.min(lt[1],it[1],nt[1],ht[1]),Math.max(lt[0],it[0],nt[0],ht[0]),Math.max(lt[1],it[1],nt[1],ht[1]),yt)):Oe(Math.min(T,T+C),Math.min(w,w+b),Math.max(T,T+C),Math.max(w,w+b),yt),f&&(x=Math.round(x),S=Math.round(S)),{drawImageX:x,drawImageY:S,drawImageW:E,drawImageH:y,originX:c,originY:h,declutterBox:{minX:yt[0],minY:yt[1],maxX:yt[2],maxY:yt[3],value:_},canvasTransform:R,scale:d}}replayImageOrLabel_(t,e,i,n,s,r,o){const l=!!(r||o),c=n.declutterBox,h=o?o[2]*n.scale[0]/2:0;return c.minX-h<=e[0]&&c.maxX+h>=0&&c.minY-h<=e[1]&&c.maxY+h>=0&&(l&&this.replayTextBackground_(t,lt,it,nt,ht,r,o),Rn(t,n.canvasTransform,s,i,n.originX,n.originY,n.drawImageW,n.drawImageH,n.drawImageX,n.drawImageY,n.scale)),!0}fill_(t){const e=this.alignAndScaleFill_;if(e){const i=vt(this.renderedTransform_,[0,0]),n=512*this.pixelRatio;t.save(),t.translate(i[0]%n,i[1]%n),e!==1&&t.scale(e,e),t.rotate(this.viewRotation_)}t.fill(),e&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],e[1]&&(t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6]))}drawLabelWithPointPlacement_(t,e,i,n){const s=this.textStates[e],r=this.createLabel(t,e,n,i),o=this.strokeStates[i],l=this.pixelRatio,c=fe(Array.isArray(t)?t[0]:t,s.textAlign||kt),h=te[s.textBaseline||zt],u=o&&o.lineWidth?o.lineWidth:0,d=r.width/l-2*s.scale[0],f=c*d+2*(.5-c)*u,p=h*r.height/l+2*(.5-h)*u;return{label:r,anchorX:f,anchorY:p}}execute_(t,e,i,n,s,r,o,l){const c=this.zIndexContext_;let h;this.pixelCoordinates_&&ee(i,this.renderedTransform_)?h=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),h=mt(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),vn(this.renderedTransform_,i));let u=0;const d=n.length;let f=0,p,g,_,x,S,E,y,C,b,T,w,R,M,A=0,L=0;const D=this.coordinateCache_,F=this.viewRotation_,W=Math.round(Math.atan2(-i[1],i[0])*1e12)/1e12,v={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:F},k=this.instructions!=n||this.overlaps?0:200;let O,Y,P,B;for(;u<d;){const m=n[u];switch(m[0]){case I.BEGIN_GEOMETRY:O=m[1],B=m[3],O.getGeometry()?o!==void 0&&!st(o,B.getExtent())?u=m[2]+1:++u:u=m[2],c&&(c.zIndex=m[4]);break;case I.BEGIN_PATH:A>k&&(this.fill_(t),A=0),L>k&&(t.stroke(),L=0),!A&&!L&&(t.beginPath(),S=NaN,E=NaN),++u;break;case I.CIRCLE:f=m[1];const Et=h[f],J=h[f+1],Dt=h[f+2],rn=h[f+3],Ue=Dt-Et,Ve=rn-J,He=Math.sqrt(Ue*Ue+Ve*Ve);t.moveTo(Et+He,J),t.arc(Et,J,He,0,2*Math.PI,!0),++u;break;case I.CLOSE_PATH:t.closePath(),++u;break;case I.CUSTOM:f=m[1],p=m[2];const on=m[3],an=m[4],je=m[5];v.geometry=on,v.feature=O,u in D||(D[u]=[]);const Ct=D[u];je?je(h,f,p,2,Ct):(Ct[0]=h[f],Ct[1]=h[f+1],Ct.length=2),c&&(c.zIndex=m[6]),an(Ct,v),++u;break;case I.DRAW_IMAGE:f=m[1],p=m[2],b=m[3],g=m[4],_=m[5];let oe=m[6];const ln=m[7],hn=m[8],cn=m[9],Ze=m[10];let ae=m[11];const un=m[12];let Mt=m[13];x=m[14]||"declutter";const It=m[15];if(!b&&m.length>=20){T=m[19],w=m[20],R=m[21],M=m[22];const q=this.drawLabelWithPointPlacement_(T,w,R,M);b=q.label,m[3]=b;const ft=m[23];g=(q.anchorX-ft)*this.pixelRatio,m[4]=g;const K=m[24];_=(q.anchorY-K)*this.pixelRatio,m[5]=_,oe=b.height,m[6]=oe,Mt=b.width,m[13]=Mt}let le;m.length>25&&(le=m[25]);let he,Pt,Gt;m.length>17?(he=m[16],Pt=m[17],Gt=m[18]):(he=_t,Pt=null,Gt=null),Ze&&W?ae+=F:!Ze&&!W&&(ae-=F);let dn=0;for(;f<p;f+=2){if(le&&le[dn++]<Mt/this.pixelRatio)continue;const q=this.calculateImageOrLabelDimensions_(b.width,b.height,h[f],h[f+1],Mt,oe,g,_,hn,cn,ae,un,s,he,!!Pt||!!Gt,O),ft=[t,e,b,q,ln,Pt,Gt];if(l){let K,z,U;if(It){const G=p-f;if(!It[G]){It[G]={args:ft,declutterMode:x};continue}const X=It[G];K=X.args,z=X.declutterMode,delete It[G],U=di(K)}let Q,tt;if(K&&(z!=="declutter"||!l.collides(U))&&(Q=!0),(x!=="declutter"||!l.collides(q.declutterBox))&&(tt=!0),z==="declutter"&&x==="declutter"){const G=Q&&tt;Q=G,tt=G}Q&&(z!=="none"&&l.insert(U),this.replayImageOrLabel_.apply(this,K)),tt&&(x!=="none"&&l.insert(q.declutterBox),this.replayImageOrLabel_.apply(this,ft))}else this.replayImageOrLabel_.apply(this,ft)}++u;break;case I.DRAW_CHARS:const Je=m[1],ze=m[2],ce=m[3],fn=m[4];M=m[5];const gn=m[6],$e=m[7],Qe=m[8];R=m[9];const ue=m[10];T=m[11],Array.isArray(T)&&(T=T.reduce(Is,"")),w=m[12];const ti=[m[13],m[13]];x=m[14]||"declutter";const _n=m[15],de=this.textStates[w],bt=de.font,Tt=[de.scale[0]*$e,de.scale[1]*$e];let Rt;bt in this.widths_?Rt=this.widths_[bt]:(Rt={},this.widths_[bt]=Rt);const ei=Ss(h,Je,ze,2),ii=Math.abs(Tt[0])*ri(bt,T,Rt);if(fn||ii<=ei){const q=this.textStates[w].textAlign,ft=(ei-ii)*fe(T,q),K=Es(h,Je,ze,2,T,ft,gn,Math.abs(Tt[0]),ri,bt,Rt,W?0:this.viewRotation_,_n);t:if(K){const z=[];let U,Q,tt,G,X;if(R)for(U=0,Q=K.length;U<Q;++U){X=K[U],tt=X[4],G=this.createLabel(tt,w,"",R),g=X[2]+(Tt[0]<0?-ue:ue),_=ce*G.height+(.5-ce)*2*ue*Tt[1]/Tt[0]-Qe;const et=this.calculateImageOrLabelDimensions_(G.width,G.height,X[0],X[1],G.width,G.height,g,_,0,0,X[3],ti,!1,_t,!1,O);if(l&&x==="declutter"&&l.collides(et.declutterBox))break t;z.push([t,e,G,et,1,null,null])}if(M)for(U=0,Q=K.length;U<Q;++U){X=K[U],tt=X[4],G=this.createLabel(tt,w,M,""),g=X[2],_=ce*G.height-Qe;const et=this.calculateImageOrLabelDimensions_(G.width,G.height,X[0],X[1],G.width,G.height,g,_,0,0,X[3],ti,!1,_t,!1,O);if(l&&x==="declutter"&&l.collides(et.declutterBox))break t;z.push([t,e,G,et,1,null,null])}l&&x!=="none"&&l.load(z.map(di));for(let et=0,pn=z.length;et<pn;++et)this.replayImageOrLabel_.apply(this,z[et])}}++u;break;case I.END_GEOMETRY:if(r!==void 0){O=m[1];const q=r(O,B,x);if(q)return q}++u;break;case I.FILL:k?A++:this.fill_(t),++u;break;case I.MOVE_TO_LINE_TO:for(f=m[1],p=m[2],Y=h[f],P=h[f+1],t.moveTo(Y,P),S=Y+.5|0,E=P+.5|0,f+=2;f<p;f+=2)Y=h[f],P=h[f+1],y=Y+.5|0,C=P+.5|0,(f==p-2||y!==S||C!==E)&&(t.lineTo(Y,P),S=y,E=C);++u;break;case I.SET_FILL_STYLE:this.alignAndScaleFill_=m[2],A&&(this.fill_(t),A=0,L&&(t.stroke(),L=0)),t.fillStyle=m[1],++u;break;case I.SET_STROKE_STYLE:L&&(t.stroke(),L=0),this.setStrokeStyle_(t,m),++u;break;case I.STROKE:k?L++:t.stroke(),++u;break;default:++u;break}}A&&this.fill_(t),L&&t.stroke()}execute(t,e,i,n,s,r){this.viewRotation_=n,this.execute_(t,e,i,this.instructions,s,void 0,void 0,r)}executeHitDetection(t,e,i,n,s){return this.viewRotation_=i,this.execute_(t,[t.canvas.width,t.canvas.height],e,this.hitDetectionInstructions,!0,n,s)}}const gt=["Polygon","Circle","LineString","Image","Text","Default"],Zi=["Image","Text"],Ts=gt.filter(a=>!Zi.includes(a));class Rs{constructor(t,e,i,n,s,r,o){this.maxExtent_=t,this.overlaps_=n,this.pixelRatio_=i,this.resolution_=e,this.renderBuffer_=r,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=Ot(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(s,o)}clip(t,e){const i=this.getClipCoords(e);t.beginPath(),t.moveTo(i[0],i[1]),t.lineTo(i[2],i[3]),t.lineTo(i[4],i[5]),t.lineTo(i[6],i[7]),t.clip()}createExecutors_(t,e){for(const i in t){let n=this.executorsByZIndex_[i];n===void 0&&(n={},this.executorsByZIndex_[i]=n);const s=t[i];for(const r in s){const o=s[r];n[r]=new bs(this.resolution_,this.pixelRatio_,this.overlaps_,o,e)}}}hasExecutors(t){for(const e in this.executorsByZIndex_){const i=this.executorsByZIndex_[e];for(let n=0,s=t.length;n<s;++n)if(t[n]in i)return!0}return!1}forEachFeatureAtCoordinate(t,e,i,n,s,r){n=Math.round(n);const o=n*2+1,l=ie(this.hitDetectionTransform_,n+.5,n+.5,1/e,-1/e,-i,-t[0],-t[1]),c=!this.hitDetectionContext_;c&&(this.hitDetectionContext_=$t(o,o));const h=this.hitDetectionContext_;h.canvas.width!==o||h.canvas.height!==o?(h.canvas.width=o,h.canvas.height=o):c||h.clearRect(0,0,o,o);let u;this.renderBuffer_!==void 0&&(u=xt(),wn(u,t),qe(u,e*(this.renderBuffer_+n),u));const d=vs(n);let f;function p(C,b,T){const w=h.getImageData(0,0,o,o).data;for(let R=0,M=d.length;R<M;R++)if(w[d[R]]>0){if(!r||T==="none"||f!=="Image"&&f!=="Text"||r.includes(C)){const A=(d[R]-3)/4,L=n-A%o,D=n-(A/o|0),F=s(C,b,L*L+D*D);if(F)return F}h.clearRect(0,0,o,o);break}}const g=Object.keys(this.executorsByZIndex_).map(Number);g.sort(qt);let _,x,S,E,y;for(_=g.length-1;_>=0;--_){const C=g[_].toString();for(S=this.executorsByZIndex_[C],x=gt.length-1;x>=0;--x)if(f=gt[x],E=S[f],E!==void 0&&(y=E.executeHitDetection(h,l,i,p,u),y))return y}}getClipCoords(t){const e=this.maxExtent_;if(!e)return null;const i=e[0],n=e[1],s=e[2],r=e[3],o=[i,n,i,r,s,r,s,n];return mt(o,0,8,2,t,o),o}isEmpty(){return Qt(this.executorsByZIndex_)}execute(t,e,i,n,s,r,o){const l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(o?Fn:qt),r=r||gt;const c=gt.length;for(let h=0,u=l.length;h<u;++h){const d=l[h].toString(),f=this.executorsByZIndex_[d];for(let p=0,g=r.length;p<g;++p){const _=r[p],x=f[_];if(x!==void 0){const S=o===null?void 0:x.getZIndexContext(),E=S?S.getContext():t,y=this.maxExtent_&&_!=="Image"&&_!=="Text";if(y&&(E.save(),this.clip(E,i)),!S||_==="Text"||_==="Image"?x.execute(E,e,i,n,s,o):S.pushFunction(C=>x.execute(C,e,i,n,s,o)),y&&E.restore(),S){S.offset();const C=l[h]*c+gt.indexOf(_);this.deferredZIndexContexts_[C]||(this.deferredZIndexContexts_[C]=[]),this.deferredZIndexContexts_[C].push(S)}}}}this.renderedContext_=t}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){const t=this.deferredZIndexContexts_,e=Object.keys(t).map(Number).sort(qt);for(let i=0,n=e.length;i<n;++i)t[e[i]].forEach(s=>{s.draw(this.renderedContext_),s.clear()}),t[e[i]].length=0}}const ge={};function vs(a){if(ge[a]!==void 0)return ge[a];const t=a*2+1,e=a*a,i=new Array(e+1);for(let s=0;s<=a;++s)for(let r=0;r<=a;++r){const o=s*s+r*r;if(o>e)break;let l=i[o];l||(l=[],i[o]=l),l.push(((a+s)*t+(a+r))*4+3),s>0&&l.push(((a-s)*t+(a+r))*4+3),r>0&&(l.push(((a+s)*t+(a-r))*4+3),s>0&&l.push(((a-s)*t+(a-r))*4+3))}const n=[];for(let s=0,r=i.length;s<r;++s)i[s]&&n.push(...i[s]);return ge[a]=n,n}class ws extends ji{constructor(t,e,i,n,s,r,o){super(),this.context_=t,this.pixelRatio_=e,this.extent_=i,this.transform_=n,this.transformRotation_=n?Ln(Math.atan2(n[1],n[0]),10):0,this.viewRotation_=s,this.squaredTolerance_=r,this.userTransform_=o,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=Ot()}drawImages_(t,e,i,n){if(!this.image_)return;const s=mt(t,e,i,n,this.transform_,this.pixelCoordinates_),r=this.context_,o=this.tmpLocalTransform_,l=r.globalAlpha;this.imageOpacity_!=1&&(r.globalAlpha=l*this.imageOpacity_);let c=this.imageRotation_;this.transformRotation_===0&&(c-=this.viewRotation_),this.imageRotateWithView_&&(c+=this.viewRotation_);for(let h=0,u=s.length;h<u;h+=2){const d=s[h]-this.imageAnchorX_,f=s[h+1]-this.imageAnchorY_;if(c!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const p=d+this.imageAnchorX_,g=f+this.imageAnchorY_;ie(o,p,g,1,1,c,-p,-g),r.save(),r.transform.apply(r,o),r.translate(p,g),r.scale(this.imageScale_[0],this.imageScale_[1]),r.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),r.restore()}else r.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,d,f,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(r.globalAlpha=l)}drawText_(t,e,i,n){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const s=mt(t,e,i,n,this.transform_,this.pixelCoordinates_),r=this.context_;let o=this.textRotation_;for(this.transformRotation_===0&&(o-=this.viewRotation_),this.textRotateWithView_&&(o+=this.viewRotation_);e<i;e+=n){const l=s[e]+this.textOffsetX_,c=s[e+1]+this.textOffsetY_;o!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(r.save(),r.translate(l-this.textOffsetX_,c-this.textOffsetY_),r.rotate(o),r.translate(this.textOffsetX_,this.textOffsetY_),r.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&r.strokeText(this.text_,0,0),this.textFillState_&&r.fillText(this.text_,0,0),r.restore()):(this.textStrokeState_&&r.strokeText(this.text_,l,c),this.textFillState_&&r.fillText(this.text_,l,c))}}moveToLineTo_(t,e,i,n,s){const r=this.context_,o=mt(t,e,i,n,this.transform_,this.pixelCoordinates_);r.moveTo(o[0],o[1]);let l=o.length;s&&(l-=2);for(let c=2;c<l;c+=2)r.lineTo(o[c],o[c+1]);return s&&r.closePath(),i}drawRings_(t,e,i,n){for(let s=0,r=i.length;s<r;++s)e=this.moveToLineTo_(t,e,i[s],n,!0);return e}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!st(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=kn(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],n=e[3]-e[1],s=Math.sqrt(i*i+n*n),r=this.context_;r.beginPath(),r.arc(e[0],e[1],s,0,2*Math.PI),this.fillState_&&r.fill(),this.strokeState_&&r.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break}}drawFeature(t,e){const i=e.getGeometryFunction()(t);i&&(this.setStyle(e),this.drawGeometry(i))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let i=0,n=e.length;i<n;++i)this.drawGeometry(e[i])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!st(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(i,0,i.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(st(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,n=t.getFlatCoordinates();let s=0;const r=t.getEnds(),o=t.getStride();i.beginPath();for(let l=0,c=r.length;l<c;++l)s=this.moveToLineTo_(n,s,r[l],o,!1);i.stroke()}if(this.text_!==""){const i=t.getFlatMidpoints();this.drawText_(i,0,i.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!st(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!st(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getOrientedFlatCoordinates();let n=0;const s=t.getEndss(),r=t.getStride();e.beginPath();for(let o=0,l=s.length;o<l;++o){const c=s[o];n=this.drawRings_(i,n,c,r)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,i=this.contextFillState_;i?i.fillStyle!=t.fillStyle&&(i.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=t.lineCap&&(i.lineCap=t.lineCap,e.lineCap=t.lineCap),ee(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash),i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),i.lineJoin!=t.lineJoin&&(i.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),i.lineWidth!=t.lineWidth&&(i.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),i.miterLimit!=t.miterLimit&&(i.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,i=this.contextTextState_,n=t.textAlign?t.textAlign:kt;i?(i.font!=t.font&&(i.font=t.font,e.font=t.font),i.textAlign!=n&&(i.textAlign=n,e.textAlign=n),i.textBaseline!=t.textBaseline&&(i.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=n,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:n,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(!t)this.fillState_=null;else{const i=t.getColor();this.fillState_={fillStyle:ut(i||H)}}if(!e)this.strokeState_=null;else{const i=e.getColor(),n=e.getLineCap(),s=e.getLineDash(),r=e.getLineDashOffset(),o=e.getLineJoin(),l=e.getWidth(),c=e.getMiterLimit(),h=s||rt;this.strokeState_={lineCap:n!==void 0?n:Vt,lineDash:this.pixelRatio_===1?h:h.map(u=>u*this.pixelRatio_),lineDashOffset:(r||ot)*this.pixelRatio_,lineJoin:o!==void 0?o:Ht,lineWidth:(l!==void 0?l:jt)*this.pixelRatio_,miterLimit:c!==void 0?c:Zt,strokeStyle:ut(i||Jt)}}}setImageStyle(t){let e;if(!t||!(e=t.getSize())){this.image_=null;return}const i=t.getPixelRatio(this.pixelRatio_),n=t.getAnchor(),s=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=n[0]*i,this.imageAnchorY_=n[1]*i,this.imageHeight_=e[1]*i,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=s[0],this.imageOriginY_=s[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const r=t.getScaleArray();this.imageScale_=[r[0]*this.pixelRatio_/i,r[1]*this.pixelRatio_/i],this.imageWidth_=e[0]*i}setTextStyle(t){if(!t)this.text_="";else{const e=t.getFill();if(!e)this.textFillState_=null;else{const f=e.getColor();this.textFillState_={fillStyle:ut(f||H)}}const i=t.getStroke();if(!i)this.textStrokeState_=null;else{const f=i.getColor(),p=i.getLineCap(),g=i.getLineDash(),_=i.getLineDashOffset(),x=i.getLineJoin(),S=i.getWidth(),E=i.getMiterLimit();this.textStrokeState_={lineCap:p!==void 0?p:Vt,lineDash:g||rt,lineDashOffset:_||ot,lineJoin:x!==void 0?x:Ht,lineWidth:S!==void 0?S:jt,miterLimit:E!==void 0?E:Zt,strokeStyle:ut(f||Jt)}}const n=t.getFont(),s=t.getOffsetX(),r=t.getOffsetY(),o=t.getRotateWithView(),l=t.getRotation(),c=t.getScaleArray(),h=t.getText(),u=t.getTextAlign(),d=t.getTextBaseline();this.textState_={font:n!==void 0?n:Xi,textAlign:u!==void 0?u:kt,textBaseline:d!==void 0?d:zt},this.text_=h!==void 0?Array.isArray(h)?h.reduce((f,p,g)=>f+=g%2?" ":p,""):h:"",this.textOffsetX_=s!==void 0?this.pixelRatio_*s:0,this.textOffsetY_=r!==void 0?this.pixelRatio_*r:0,this.textRotateWithView_=o!==void 0?o:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*c[0],this.pixelRatio_*c[1]]}}}const $=.5;function Fs(a,t,e,i,n,s,r,o,l){const c=n,h=a[0]*$,u=a[1]*$,d=$t(h,u);d.imageSmoothingEnabled=!1;const f=d.canvas,p=new ws(d,$,n,null,r,o,null),g=e.length,_=Math.floor((256*256*256-1)/g),x={};for(let E=1;E<=g;++E){const y=e[E-1],C=y.getStyleFunction()||i;if(!C)continue;let b=C(y,s);if(!b)continue;Array.isArray(b)||(b=[b]);const w=(E*_).toString(16).padStart(7,"#00000");for(let R=0,M=b.length;R<M;++R){const A=b[R],L=A.getGeometryFunction()(y);if(!L||!st(c,L.getExtent()))continue;const D=A.clone(),F=D.getFill();F&&F.setColor(w);const W=D.getStroke();W&&(W.setColor(w),W.setLineDash(null)),D.setText(void 0);const v=A.getImage();if(v){const P=v.getImageSize();if(!P)continue;const B=$t(P[0],P[1],void 0,{alpha:!1}),m=B.canvas;B.fillStyle=w,B.fillRect(0,0,m.width,m.height),D.setImage(new On({img:m,anchor:v.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:v.getOrigin(),opacity:1,size:v.getSize(),scale:v.getScale(),rotation:v.getRotation(),rotateWithView:v.getRotateWithView()}))}const k=D.getZIndex()||0;let O=x[k];O||(O={},x[k]=O,O.Polygon=[],O.Circle=[],O.LineString=[],O.Point=[]);const Y=L.getType();if(Y==="GeometryCollection"){const P=L.getGeometriesArrayRecursive();for(let B=0,m=P.length;B<m;++B){const St=P[B];O[St.getType().replace("Multi","")].push(St,D)}}else O[Y.replace("Multi","")].push(L,D)}}const S=Object.keys(x).map(Number).sort(qt);for(let E=0,y=S.length;E<y;++E){const C=x[S[E]];for(const b in C){const T=C[b];for(let w=0,R=T.length;w<R;w+=2){p.setStyle(T[w+1]);for(let M=0,A=t.length;M<A;++M)p.setTransform(t[M]),p.drawGeometry(T[w])}}}return d.getImageData(0,0,f.width,f.height)}function Ls(a,t,e){const i=[];if(e){const n=Math.floor(Math.round(a[0])*$),s=Math.floor(Math.round(a[1])*$),r=(oi(n,0,e.width-1)+oi(s,0,e.height-1)*e.width)*4,o=e.data[r],l=e.data[r+1],h=e.data[r+2]+256*(l+256*o),u=Math.floor((256*256*256-1)/t.length);h&&h%u===0&&i.push(t[h/u-1])}return i}const ks=.5,Ji={Point:Bs,LineString:Ps,Polygon:Xs,MultiPoint:Ys,MultiLineString:Gs,MultiPolygon:Ws,GeometryCollection:Ms,Circle:As};function Os(a,t){return parseInt(N(a),10)-parseInt(N(t),10)}function gi(a,t){const e=zi(a,t);return e*e}function zi(a,t){return ks*a/t}function As(a,t,e,i,n){const s=e.getFill(),r=e.getStroke();if(s||r){const l=a.getBuilder(e.getZIndex(),"Circle");l.setFillStrokeStyle(s,r),l.drawCircle(t,i,n)}const o=e.getText();if(o&&o.getText()){const l=a.getBuilder(e.getZIndex(),"Text");l.setTextStyle(o),l.drawText(t,i)}}function _i(a,t,e,i,n,s,r,o){const l=[],c=e.getImage();if(c){let d=!0;const f=c.getImageState();f==Lt.LOADED||f==Lt.ERROR?d=!1:f==Lt.IDLE&&c.load(),d&&l.push(c.ready())}const h=e.getFill();h&&h.loading()&&l.push(h.ready());const u=l.length>0;return u&&Promise.all(l).then(()=>n(null)),Ds(a,t,e,i,s,r,o),u}function Ds(a,t,e,i,n,s,r){const o=e.getGeometryFunction()(t);if(!o)return;const l=o.simplifyTransformed(i,n);if(e.getRenderer())$i(a,l,e,t,r);else{const h=Ji[l.getType()];h(a,l,e,t,r,s)}}function $i(a,t,e,i,n){if(t.getType()=="GeometryCollection"){const r=t.getGeometries();for(let o=0,l=r.length;o<l;++o)$i(a,r[o],e,i,n);return}a.getBuilder(e.getZIndex(),"Default").drawCustom(t,i,e.getRenderer(),e.getHitDetectionRenderer(),n)}function Ms(a,t,e,i,n,s){const r=t.getGeometriesArray();let o,l;for(o=0,l=r.length;o<l;++o){const c=Ji[r[o].getType()];c(a,r[o],e,i,n,s)}}function Ps(a,t,e,i,n){const s=e.getStroke();if(s){const o=a.getBuilder(e.getZIndex(),"LineString");o.setFillStrokeStyle(null,s),o.drawLineString(t,i,n)}const r=e.getText();if(r&&r.getText()){const o=a.getBuilder(e.getZIndex(),"Text");o.setTextStyle(r),o.drawText(t,i,n)}}function Gs(a,t,e,i,n){const s=e.getStroke();if(s){const o=a.getBuilder(e.getZIndex(),"LineString");o.setFillStrokeStyle(null,s),o.drawMultiLineString(t,i,n)}const r=e.getText();if(r&&r.getText()){const o=a.getBuilder(e.getZIndex(),"Text");o.setTextStyle(r),o.drawText(t,i,n)}}function Ws(a,t,e,i,n){const s=e.getFill(),r=e.getStroke();if(r||s){const l=a.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(s,r),l.drawMultiPolygon(t,i,n)}const o=e.getText();if(o&&o.getText()){const l=a.getBuilder(e.getZIndex(),"Text");l.setTextStyle(o),l.drawText(t,i,n)}}function Bs(a,t,e,i,n,s){const r=e.getImage(),o=e.getText(),l=o&&o.getText(),c=s&&r&&l?{}:void 0;if(r){if(r.getImageState()!=Lt.LOADED)return;const h=a.getBuilder(e.getZIndex(),"Image");h.setImageStyle(r,c),h.drawPoint(t,i,n)}if(l){const h=a.getBuilder(e.getZIndex(),"Text");h.setTextStyle(o,c),h.drawText(t,i,n)}}function Ys(a,t,e,i,n,s){const r=e.getImage(),o=r&&r.getOpacity()!==0,l=e.getText(),c=l&&l.getText(),h=s&&o&&c?{}:void 0;if(o){if(r.getImageState()!=Lt.LOADED)return;const u=a.getBuilder(e.getZIndex(),"Image");u.setImageStyle(r,h),u.drawMultiPoint(t,i,n)}if(c){const u=a.getBuilder(e.getZIndex(),"Text");u.setTextStyle(l,h),u.drawText(t,i,n)}}function Xs(a,t,e,i,n){const s=e.getFill(),r=e.getStroke();if(s||r){const l=a.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(s,r),l.drawPolygon(t,i,n)}const o=e.getText();if(o&&o.getText()){const l=a.getBuilder(e.getZIndex(),"Text");l.setTextStyle(o),l.drawText(t,i,n)}}class Ns extends An{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=xt(),this.wrappedRenderedExtent_=xt(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(t,e,i){const n=e.extent,s=e.viewState,r=s.center,o=s.resolution,l=s.projection,c=s.rotation,h=l.getExtent(),u=this.getLayer().getSource(),d=this.getLayer().getDeclutter(),f=e.pixelRatio,p=e.viewHints,g=!(p[Bt.ANIMATING]||p[Bt.INTERACTING]),_=this.context,x=Math.round(wt(n)/o*f),S=Math.round(Ae(n)/o*f),E=u.getWrapX()&&l.canWrapX(),y=E?wt(h):null,C=E?Math.ceil((n[2]-h[2])/y)+1:1;let b=E?Math.floor((n[0]-h[0])/y):0;do{let T=this.getRenderTransform(r,o,0,f,x,S,b*y);e.declutter&&(T=T.slice(0)),t.execute(_,[_.canvas.width,_.canvas.height],T,c,g,i===void 0?gt:i?Zi:Ts,i?d&&e.declutter[d]:void 0)}while(++b<C)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=$t(this.context.canvas.width,this.context.canvas.height,ai))}resetDrawContext_(){if(this.opacity_!==1&&this.targetContext_){const t=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=t,Dn(this.context),ai.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(t){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,t,!0)}renderDeferredInternal(t){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(t,e){const i=t.layerStatesArray[t.layerIndex];this.opacity_=i.opacity;const n=t.viewState;this.prepareContainer(t,e);const s=this.context,r=this.replayGroup_;let o=r&&!r.isEmpty();if(!o&&!(this.getLayer().hasListener(li.PRERENDER)||this.getLayer().hasListener(li.POSTRENDER)))return this.container;if(this.setDrawContext_(),this.preRender(s,t),n.projection,this.clipped_=!1,o&&i.extent&&this.clipping){const l=Mn(i.extent);o=st(l,t.extent),this.clipped_=o&&!Ft(l,t.extent),this.clipped_&&this.clipUnrotated(s,t,l)}return o&&this.renderWorlds(r,t,this.getLayer().getDeclutter()?!1:void 0),!t.declutter&&this.clipped_&&s.restore(),this.postRender(s,t),this.renderedRotation_!==n.rotation&&(this.renderedRotation_=n.rotation,this.hitDetectionImageData_=null),t.declutter||this.resetDrawContext_(),this.container}getFeatures(t){return new Promise(e=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const i=this.frameState.size.slice(),n=this.renderedCenter_,s=this.renderedResolution_,r=this.renderedRotation_,o=this.renderedProjection_,l=this.wrappedRenderedExtent_,c=this.getLayer(),h=[],u=i[0]*$,d=i[1]*$;h.push(this.getRenderTransform(n,s,r,$,u,d,0).slice());const f=c.getSource(),p=o.getExtent();if(f.getWrapX()&&o.canWrapX()&&!Ft(p,l)){let g=l[0];const _=wt(p);let x=0,S;for(;g<p[0];)--x,S=_*x,h.push(this.getRenderTransform(n,s,r,$,u,d,S).slice()),g+=_;for(x=0,g=l[2];g>p[2];)++x,S=_*x,h.push(this.getRenderTransform(n,s,r,$,u,d,S).slice()),g-=_}this.hitDetectionImageData_=Fs(i,h,this.renderedFeatures_,c.getStyleFunction(),l,s,r,gi(s,this.renderedPixelRatio_))}e(Ls(t,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(t,e,i,n,s){if(!this.replayGroup_)return;const r=e.viewState.resolution,o=e.viewState.rotation,l=this.getLayer(),c={},h=function(d,f,p){const g=N(d),_=c[g];if(_){if(_!==!0&&p<_.distanceSq){if(p===0)return c[g]=!0,s.splice(s.lastIndexOf(_),1),n(d,l,f);_.geometry=f,_.distanceSq=p}}else{if(p===0)return c[g]=!0,n(d,l,f);s.push(c[g]={feature:d,layer:l,geometry:f,distanceSq:p,callback:n})}},u=this.getLayer().getDeclutter();return this.replayGroup_.forEachFeatureAtCoordinate(t,r,o,i,h,u?e.declutter?.[u]?.all().map(d=>d.value):null)}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){const e=this.getLayer(),i=e.getSource();if(!i)return!1;const n=t.viewHints[Bt.ANIMATING],s=t.viewHints[Bt.INTERACTING],r=e.getUpdateWhileAnimating(),o=e.getUpdateWhileInteracting();if(this.ready&&!r&&n||!o&&s)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const l=t.extent,c=t.viewState,h=c.projection,u=c.resolution,d=t.pixelRatio,f=e.getRevision(),p=e.getRenderBuffer();let g=e.getRenderOrder();g===void 0&&(g=Os);const _=c.center.slice(),x=qe(l,p*u),S=x.slice(),E=[x.slice()],y=h.getExtent();if(i.getWrapX()&&h.canWrapX()&&!Ft(y,t.extent)){const F=wt(y),W=Math.max(wt(x)/2,F);x[0]=y[0]-W,x[2]=y[2]+W,Pn(_,h);const v=Gn(E[0],h);v[0]<y[0]&&v[2]<y[2]?E.push([v[0]+F,v[1],v[2]+F,v[3]]):v[0]>y[0]&&v[2]>y[2]&&E.push([v[0]-F,v[1],v[2]-F,v[3]])}if(this.ready&&this.renderedResolution_==u&&this.renderedRevision_==f&&this.renderedRenderOrder_==g&&this.renderedFrameDeclutter_===!!t.declutter&&Ft(this.wrappedRenderedExtent_,x))return ee(this.renderedExtent_,S)||(this.hitDetectionImageData_=null,this.renderedExtent_=S),this.renderedCenter_=_,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const C=new ms(zi(u,d),x,u,d);let b;for(let F=0,W=E.length;F<W;++F)i.loadFeatures(E[F],u,h);const T=gi(u,d);let w=!0;const R=(F,W)=>{let v;const k=F.getStyleFunction()||e.getStyleFunction();if(k&&(v=k(F,u)),v){const O=this.renderFeature(F,T,v,C,b,this.getLayer().getDeclutter(),W);w=w&&!O}},M=Wn(x),A=i.getFeaturesInExtent(M);g&&A.sort(g);for(let F=0,W=A.length;F<W;++F)R(A[F],F);this.renderedFeatures_=A,this.ready=w;const L=C.finish(),D=new Rs(x,u,d,i.getOverlaps(),L,e.getRenderBuffer(),!!t.declutter);return this.renderedResolution_=u,this.renderedRevision_=f,this.renderedRenderOrder_=g,this.renderedFrameDeclutter_=!!t.declutter,this.renderedExtent_=S,this.wrappedRenderedExtent_=x,this.renderedCenter_=_,this.renderedProjection_=h,this.renderedPixelRatio_=d,this.replayGroup_=D,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,e,i,n,s,r,o){if(!i)return!1;let l=!1;if(Array.isArray(i))for(let c=0,h=i.length;c<h;++c)l=_i(n,t,i[c],e,this.boundHandleStyleImageChange_,s,r,o)||l;else l=_i(n,t,i,e,this.boundHandleStyleImageChange_,s,r,o);return l}}class qs extends Bn{constructor(t){super(t)}createRenderer(){return new Ns(this)}}let Ks=!1;function Us(a,t,e,i,n,s,r){const o=new XMLHttpRequest;o.open("GET",typeof a=="function"?a(e,i,n):a,!0),t.getType()=="arraybuffer"&&(o.responseType="arraybuffer"),o.withCredentials=Ks,o.onload=function(l){if(!o.status||o.status>=200&&o.status<300){const c=t.getType();try{let h;c=="text"||c=="json"?h=o.responseText:c=="xml"?h=o.responseXML||o.responseText:c=="arraybuffer"&&(h=o.response),h?s(t.readFeatures(h,{extent:e,featureProjection:n}),t.readProjection(h)):r()}catch{r()}}else r()},o.onerror=r,o.send()}function pi(a,t){return function(e,i,n,s,r){Us(a,t,e,i,n,(o,l)=>{this.addFeatures(o),s!==void 0&&s(o)},()=>{this.changed(),r!==void 0&&r()})}}function Vs(a,t){return[[-1/0,-1/0,1/0,1/0]]}class Qi extends Yn{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){const e=t;this.setGeometry(e)}else{const e=t;this.setProperties(e)}}clone(){const t=new Qi(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const i=this.getStyle();return i&&t.setStyle(i),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(De(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=Me(t,Ni.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?Hs(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function Hs(a){if(typeof a=="function")return a;let t;return Array.isArray(a)?t=a:(Kt(typeof a.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),t=[a]),function(){return t}}function js(a,t,e,i){const n=[];let s=xt();for(let r=0,o=e.length;r<o;++r){const l=e[r];s=qi(a,t,l[0],i),n.push((s[0]+s[2])/2,(s[1]+s[3])/2),t=l[l.length-1]}return n}function xi(a,t,e,i,n,s,r){let o,l;const c=(e-t)/i;if(c===1)o=t;else if(c===2)o=t,l=n;else if(c!==0){let h=a[t],u=a[t+1],d=0;const f=[0];for(let _=t+i;_<e;_+=i){const x=a[_],S=a[_+1];d+=Math.sqrt((x-h)*(x-h)+(S-u)*(S-u)),f.push(d),h=x,u=S}const p=n*d,g=Xn(f,p);g<0?(l=(p-f[-g-2])/(f[-g-1]-f[-g-2]),o=t+(-g-2)*i):o=t+g*i}r=r>1?r:2,s=s||new Array(r);for(let h=0;h<r;++h)s[h]=o===void 0?NaN:l===void 0?a[o+h]:j(a[o+h],a[o+i+h],l);return s}function yi(a,t,e,i,n,s){if(e==t)return null;let r;if(n<a[t+i-1])return s?(r=a.slice(t,t+i),r[i-1]=n,r):null;if(a[e-1]<n)return s?(r=a.slice(e-i,e),r[i-1]=n,r):null;if(n==a[t+i-1])return a.slice(t,t+i);let o=t/i,l=e/i;for(;o<l;){const d=o+l>>1;n<a[(d+1)*i-1]?l=d:o=d+1}const c=a[o*i-1];if(n==c)return a.slice((o-1)*i,(o-1)*i+i);const h=a[(o+1)*i-1],u=(n-c)/(h-c);r=[];for(let d=0;d<i-1;++d)r.push(j(a[(o-1)*i+d],a[o*i+d],u));return r.push(n),r}function Rr(a,t,e,i,n,s,r){if(r)return yi(a,t,e[e.length-1],i,n,s);let o;if(n<a[i-1])return s?(o=a.slice(0,i),o[i-1]=n,o):null;if(a[a.length-1]<n)return s?(o=a.slice(a.length-i),o[i-1]=n,o):null;for(let l=0,c=e.length;l<c;++l){const h=e[l];if(t!=h){if(n<a[t+i-1])return null;if(n<=a[h-1])return yi(a,t,h,i,n,!1);t=h}}return null}const mi=Ot();class Z{constructor(t,e,i,n,s,r){this.styleFunction,this.extent_,this.id_=r,this.type_=t,this.flatCoordinates_=e,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=i||null,this.properties_=s,this.squaredTolerance_,this.stride_=n,this.simplifiedGeometry_}get(t){return this.properties_[t]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?Nn(this.flatCoordinates_):qi(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const t=qn(this.getExtent());this.flatInteriorPoints_=Kn(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const t=Un(this.flatCoordinates_,this.ends_),e=js(this.flatCoordinates_,0,t,2);this.flatInteriorPoints_=Vn(this.flatCoordinates_,0,t,2,e)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=xi(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const t=this.flatCoordinates_;let e=0;const i=this.ends_;for(let n=0,s=i.length;n<s;++n){const r=i[n],o=xi(t,e,r,2,.5);Ki(this.flatMidpoints_,o),e=r}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(t){return this}simplifyTransformed(t,e){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(t){t=Hn(t);const e=t.getExtent(),i=t.getWorldExtent();if(e&&i){const n=Ae(i)/Ae(e);ie(mi,i[0],i[3],n,-n,0,0,0),mt(this.flatCoordinates_,0,this.flatCoordinates_.length,2,mi,this.flatCoordinates_)}}applyTransform(t){t(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){return new Z(this.type_,this.flatCoordinates_.slice(),this.ends_?.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=jn((t,e)=>{if(t===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),e&&this.simplifiedGeometry_.applyTransform(e);const i=this.simplifiedGeometry_.getFlatCoordinates();let n;switch(this.type_){case"LineString":i.length=zn(i,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,t,i,0),n=[i.length];break;case"MultiLineString":n=[],i.length=Jn(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,t,i,0,n);break;case"Polygon":n=[],i.length=Zn(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(t),i,0,n);break}return n&&(this.simplifiedGeometry_=new Z(this.type_,i,n,2,this.properties_,this.id_)),this.squaredTolerance_=t,this.simplifiedGeometry_}),this}}Z.prototype.getFlatCoordinates=Z.prototype.getOrientedFlatCoordinates;class Si{constructor(t){this.rbush_=new $n(t),this.items_={}}insert(t,e){const i={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(i),this.items_[N(e)]=i}load(t,e){const i=new Array(e.length);for(let n=0,s=e.length;n<s;n++){const r=t[n],o=e[n],l={minX:r[0],minY:r[1],maxX:r[2],maxY:r[3],value:o};i[n]=l,this.items_[N(o)]=l}this.rbush_.load(i)}remove(t){const e=N(t),i=this.items_[e];return delete this.items_[e],this.rbush_.remove(i)!==null}update(t,e){const i=this.items_[N(e)],n=[i.minX,i.minY,i.maxX,i.maxY];Ui(n,t)||(this.remove(e),this.insert(t,e))}getAll(){return this.rbush_.all().map(function(e){return e.value})}getInExtent(t){const e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map(function(n){return n.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,e){return this.forEach_(this.getInExtent(t),e)}forEach_(t,e){let i;for(let n=0,s=t.length;n<s;n++)if(i=e(t[n]),i)return i;return i}isEmpty(){return Qt(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){const e=this.rbush_.toJSON();return Oe(e.minX,e.minY,e.maxX,e.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(const e in t.items_)this.items_[e]=t.items_[e]}}const V={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};class ct extends rs{constructor(t,e,i){super(t),this.feature=e,this.features=i}}class vr extends Qn{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:t.wrapX!==void 0?t.wrapX:!0}),this.on,this.once,this.un,this.loader_=ts,this.format_=t.format||null,this.overlaps_=t.overlaps===void 0?!0:t.overlaps,this.url_=t.url,t.loader!==void 0?this.loader_=t.loader:this.url_!==void 0&&(Kt(this.format_,"`format` must be set when `url` is set"),this.loader_=pi(this.url_,this.format_)),this.strategy_=t.strategy!==void 0?t.strategy:Vs;const e=t.useSpatialIndex!==void 0?t.useSpatialIndex:!0;this.featuresRtree_=e?new Si:null,this.loadedExtentsRtree_=new Si,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let i,n;Array.isArray(t.features)?n=t.features:t.features&&(i=t.features,n=i.getArray()),!e&&i===void 0&&(i=new es(n)),n!==void 0&&this.addFeaturesInternal(n),i!==void 0&&this.bindFeaturesCollection_(i)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){const e=N(t);if(!this.addToIndex_(e,t)){this.featuresCollection_&&this.featuresCollection_.remove(t);return}this.setupChangeEvents_(e,t);const i=t.getGeometry();if(i){const n=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(n,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new ct(V.ADDFEATURE,t))}setupChangeEvents_(t,e){e instanceof Z||(this.featureChangeKeys_[t]=[Me(e,Ni.CHANGE,this.handleFeatureChange_,this),Me(e,is.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(t,e){let i=!0;if(e.getId()!==void 0){const n=String(e.getId());if(!(n in this.idIndex_))this.idIndex_[n]=e;else if(e instanceof Z){const s=this.idIndex_[n];s instanceof Z?Array.isArray(s)?s.push(e):this.idIndex_[n]=[s,e]:i=!1}else i=!1}return i&&(Kt(!(t in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[t]=e),i}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){const e=[],i=[],n=[];for(let s=0,r=t.length;s<r;s++){const o=t[s],l=N(o);this.addToIndex_(l,o)&&i.push(o)}for(let s=0,r=i.length;s<r;s++){const o=i[s],l=N(o);this.setupChangeEvents_(l,o);const c=o.getGeometry();if(c){const h=c.getExtent();e.push(h),n.push(o)}else this.nullGeometryFeatures_[l]=o}if(this.featuresRtree_&&this.featuresRtree_.load(e,n),this.hasListener(V.ADDFEATURE))for(let s=0,r=i.length;s<r;s++)this.dispatchEvent(new ct(V.ADDFEATURE,i[s]))}bindFeaturesCollection_(t){let e=!1;this.addEventListener(V.ADDFEATURE,function(i){e||(e=!0,t.push(i.feature),e=!1)}),this.addEventListener(V.REMOVEFEATURE,function(i){e||(e=!0,t.remove(i.feature),e=!1)}),t.addEventListener(hi.ADD,i=>{e||(e=!0,this.addFeature(i.element),e=!1)}),t.addEventListener(hi.REMOVE,i=>{e||(e=!0,this.removeFeature(i.element),e=!1)}),this.featuresCollection_=t}clear(t){if(t){for(const i in this.featureChangeKeys_)this.featureChangeKeys_[i].forEach(De);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){this.featuresRtree_.forEach(i=>{this.removeFeatureInternal(i)});for(const i in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[i])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const e=new ct(V.CLEAR);this.dispatchEvent(e),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,e){const i=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(i,function(n){const s=n.getGeometry();if(s instanceof Z||s.intersectsCoordinate(t))return e(n)})}forEachFeatureInExtent(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureIntersectingExtent(t,e){return this.forEachFeatureInExtent(t,function(i){const n=i.getGeometry();if(n instanceof Z||n.intersectsExtent(t)){const s=e(i);if(s)return s}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),Qt(this.nullGeometryFeatures_)||Ki(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){const e=[];return this.forEachFeatureAtCoordinateDirect(t,function(i){e.push(i)}),e}getFeaturesInExtent(t,e){if(this.featuresRtree_){if(!(e&&e.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);const n=ns(t,e);return[].concat(...n.map(s=>this.featuresRtree_.getInExtent(s)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,e){const i=t[0],n=t[1];let s=null;const r=[NaN,NaN];let o=1/0;const l=[-1/0,-1/0,1/0,1/0];return e=e||ss,this.featuresRtree_.forEachInExtent(l,function(c){if(e(c)){const h=c.getGeometry(),u=o;if(o=h instanceof Z?0:h.closestPointXY(i,n,r,o),o<u){s=c;const d=Math.sqrt(o);l[0]=i-d,l[1]=n-d,l[2]=i+d,l[3]=n+d}}}),s}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){const e=this.idIndex_[t.toString()];return e!==void 0?e:null}getFeatureByUid(t){const e=this.uidIndex_[t];return e!==void 0?e:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){const e=t.target,i=N(e),n=e.getGeometry();if(!n)i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[i]=e);else{const r=n.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(r,e)):this.featuresRtree_&&this.featuresRtree_.update(r,e)}const s=e.getId();if(s!==void 0){const r=s.toString();this.idIndex_[r]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[r]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[i]=e;this.changed(),this.dispatchEvent(new ct(V.CHANGEFEATURE,e))}hasFeature(t){const e=t.getId();return e!==void 0?e in this.idIndex_:N(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&Qt(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(t,e,i){const n=this.loadedExtentsRtree_,s=this.strategy_(t,e,i);for(let r=0,o=s.length;r<o;++r){const l=s[r];n.forEachInExtent(l,function(h){return Ft(h.extent,l)})||(++this.loadingExtentsCount_,this.dispatchEvent(new ct(V.FEATURESLOADSTART)),this.loader_.call(this,l,e,i,h=>{--this.loadingExtentsCount_,this.dispatchEvent(new ct(V.FEATURESLOADEND,void 0,h))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new ct(V.FEATURESLOADERROR))}),n.insert(l,{extent:l.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){const e=this.loadedExtentsRtree_,i=e.forEachInExtent(t,function(n){if(Ui(n.extent,t))return n});i&&e.remove(i)}removeFeatures(t){let e=!1;for(let i=0,n=t.length;i<n;++i)e=this.removeFeatureInternal(t[i])||e;e&&this.changed()}removeFeature(t){if(!t)return;this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){const e=N(t);if(!(e in this.uidIndex_))return!1;e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t),this.featureChangeKeys_[e]?.forEach(De),delete this.featureChangeKeys_[e];const n=t.getId();if(n!==void 0){const s=n.toString(),r=this.idIndex_[s];r===t?delete this.idIndex_[s]:Array.isArray(r)&&(r.splice(r.indexOf(t),1),r.length===1&&(this.idIndex_[s]=r[0]))}return delete this.uidIndex_[e],this.hasListener(V.REMOVEFEATURE)&&this.dispatchEvent(new ct(V.REMOVEFEATURE,t)),!0}removeFromIdIndex_(t){for(const e in this.idIndex_)if(this.idIndex_[e]===t){delete this.idIndex_[e];break}}setLoader(t){this.loader_=t}setUrl(t){Kt(this.format_,"`format` must be set when `url` is set"),this.url_=t,this.setLoader(pi(t,this.format_))}setOverlaps(t){this.overlaps_=t,this.changed()}}var _e,Ei;function Zs(){if(Ei)return _e;Ei=1;var a=Object.prototype,t=a.hasOwnProperty;function e(i,n){return i!=null&&t.call(i,n)}return _e=e,_e}var pe,Ci;function Ke(){if(Ci)return pe;Ci=1;var a=os(),t=as(),e="[object Symbol]";function i(n){return typeof n=="symbol"||t(n)&&a(n)==e}return pe=i,pe}var xe,Ii;function Js(){if(Ii)return xe;Ii=1;var a=ne(),t=Ke(),e=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,i=/^\w*$/;function n(s,r){if(a(s))return!1;var o=typeof s;return o=="number"||o=="symbol"||o=="boolean"||s==null||t(s)?!0:i.test(s)||!e.test(s)||r!=null&&s in Object(r)}return xe=n,xe}var ye,bi;function zs(){if(bi)return ye;bi=1;var a=ls(),t="Expected a function";function e(i,n){if(typeof i!="function"||n!=null&&typeof n!="function")throw new TypeError(t);var s=function(){var r=arguments,o=n?n.apply(this,r):r[0],l=s.cache;if(l.has(o))return l.get(o);var c=i.apply(this,r);return s.cache=l.set(o,c)||l,c};return s.cache=new(e.Cache||a),s}return e.Cache=a,ye=e,ye}var me,Ti;function $s(){if(Ti)return me;Ti=1;var a=zs(),t=500;function e(i){var n=a(i,function(r){return s.size===t&&s.clear(),r}),s=n.cache;return n}return me=e,me}var Se,Ri;function Qs(){if(Ri)return Se;Ri=1;var a=$s(),t=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,e=/\\(\\)?/g,i=a(function(n){var s=[];return n.charCodeAt(0)===46&&s.push(""),n.replace(t,function(r,o,l,c){s.push(l?c.replace(e,"$1"):o||r)}),s});return Se=i,Se}var Ee,vi;function tr(){if(vi)return Ee;vi=1;function a(t,e){for(var i=-1,n=t==null?0:t.length,s=Array(n);++i<n;)s[i]=e(t[i],i,t);return s}return Ee=a,Ee}var Ce,wi;function er(){if(wi)return Ce;wi=1;var a=hs(),t=tr(),e=ne(),i=Ke(),n=a?a.prototype:void 0,s=n?n.toString:void 0;function r(o){if(typeof o=="string")return o;if(e(o))return t(o,r)+"";if(i(o))return s?s.call(o):"";var l=o+"";return l=="0"&&1/o==-1/0?"-0":l}return Ce=r,Ce}var Ie,Fi;function ir(){if(Fi)return Ie;Fi=1;var a=er();function t(e){return e==null?"":a(e)}return Ie=t,Ie}var be,Li;function nr(){if(Li)return be;Li=1;var a=ne(),t=Js(),e=Qs(),i=ir();function n(s,r){return a(s)?s:t(s,r)?[s]:e(i(s))}return be=n,be}var Te,ki;function sr(){if(ki)return Te;ki=1;var a=9007199254740991,t=/^(?:0|[1-9]\d*)$/;function e(i,n){var s=typeof i;return n=n??a,!!n&&(s=="number"||s!="symbol"&&t.test(i))&&i>-1&&i%1==0&&i<n}return Te=e,Te}var Re,Oi;function rr(){if(Oi)return Re;Oi=1;var a=9007199254740991;function t(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=a}return Re=t,Re}var ve,Ai;function or(){if(Ai)return ve;Ai=1;var a=Ke();function t(e){if(typeof e=="string"||a(e))return e;var i=e+"";return i=="0"&&1/e==-1/0?"-0":i}return ve=t,ve}var we,Di;function ar(){if(Di)return we;Di=1;var a=nr(),t=cs(),e=ne(),i=sr(),n=rr(),s=or();function r(o,l,c){l=a(l,o);for(var h=-1,u=l.length,d=!1;++h<u;){var f=s(l[h]);if(!(d=o!=null&&c(o,f)))break;o=o[f]}return d||++h!=u?d:(u=o==null?0:o.length,!!u&&n(u)&&i(f,u)&&(e(o)||t(o)))}return we=r,we}var Fe,Mi;function lr(){if(Mi)return Fe;Mi=1;var a=Zs(),t=ar();function e(i,n){return i!=null&&t(i,n,a)}return Fe=e,Fe}var hr=lr();const cr=us(hr);var Pe=function(a,t){return Pe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])},Pe(a,t)};function se(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");Pe(a,t);function e(){this.constructor=a}a.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function Ge(a){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&a[t],i=0;if(e)return e.call(a);if(a&&typeof a.length=="number")return{next:function(){return a&&i>=a.length&&(a=void 0),{value:a&&a[i++],done:!a}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function We(a,t){var e=typeof Symbol=="function"&&a[Symbol.iterator];if(!e)return a;var i=e.call(a),n,s=[],r;try{for(;(t===void 0||t-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(o){r={error:o}}finally{try{n&&!n.done&&(e=i.return)&&e.call(i)}finally{if(r)throw r.error}}return s}function Be(a,t,e){if(e||arguments.length===2)for(var i=0,n=t.length,s;i<n;i++)(s||!(i in t))&&(s||(s=Array.prototype.slice.call(t,0,i)),s[i]=t[i]);return a.concat(s||Array.prototype.slice.call(t))}function at(a){return typeof a=="function"}function tn(a){var t=function(i){Error.call(i),i.stack=new Error().stack},e=a(t);return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var Le=tn(function(a){return function(e){a(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(i,n){return n+1+") "+i.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function Ye(a,t){if(a){var e=a.indexOf(t);0<=e&&a.splice(e,1)}}var re=function(){function a(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return a.prototype.unsubscribe=function(){var t,e,i,n,s;if(!this.closed){this.closed=!0;var r=this._parentage;if(r)if(this._parentage=null,Array.isArray(r))try{for(var o=Ge(r),l=o.next();!l.done;l=o.next()){var c=l.value;c.remove(this)}}catch(g){t={error:g}}finally{try{l&&!l.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}else r.remove(this);var h=this.initialTeardown;if(at(h))try{h()}catch(g){s=g instanceof Le?g.errors:[g]}var u=this._finalizers;if(u){this._finalizers=null;try{for(var d=Ge(u),f=d.next();!f.done;f=d.next()){var p=f.value;try{Pi(p)}catch(g){s=s??[],g instanceof Le?s=Be(Be([],We(s)),We(g.errors)):s.push(g)}}}catch(g){i={error:g}}finally{try{f&&!f.done&&(n=d.return)&&n.call(d)}finally{if(i)throw i.error}}}if(s)throw new Le(s)}},a.prototype.add=function(t){var e;if(t&&t!==this)if(this.closed)Pi(t);else{if(t instanceof a){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(e=this._finalizers)!==null&&e!==void 0?e:[]).push(t)}},a.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},a.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},a.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&Ye(e,t)},a.prototype.remove=function(t){var e=this._finalizers;e&&Ye(e,t),t instanceof a&&t._removeParent(this)},a.EMPTY=function(){var t=new a;return t.closed=!0,t}(),a}(),en=re.EMPTY;function nn(a){return a instanceof re||a&&"closed"in a&&at(a.remove)&&at(a.add)&&at(a.unsubscribe)}function Pi(a){at(a)?a():a.unsubscribe()}var ur={Promise:void 0},dr={setTimeout:function(a,t){for(var e=[],i=2;i<arguments.length;i++)e[i-2]=arguments[i];return setTimeout.apply(void 0,Be([a,t],We(e)))},clearTimeout:function(a){return clearTimeout(a)},delegate:void 0};function fr(a){dr.setTimeout(function(){throw a})}function Gi(){}function Ut(a){a()}var sn=function(a){se(t,a);function t(e){var i=a.call(this)||this;return i.isStopped=!1,e?(i.destination=e,nn(e)&&e.add(i)):i.destination=pr,i}return t.create=function(e,i,n){return new Xe(e,i,n)},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,a.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(re),gr=function(){function a(t){this.partialObserver=t}return a.prototype.next=function(t){var e=this.partialObserver;if(e.next)try{e.next(t)}catch(i){Nt(i)}},a.prototype.error=function(t){var e=this.partialObserver;if(e.error)try{e.error(t)}catch(i){Nt(i)}else Nt(t)},a.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(e){Nt(e)}},a}(),Xe=function(a){se(t,a);function t(e,i,n){var s=a.call(this)||this,r;return at(e)||!e?r={next:e??void 0,error:i??void 0,complete:n??void 0}:r=e,s.destination=new gr(r),s}return t}(sn);function Nt(a){fr(a)}function _r(a){throw a}var pr={closed:!0,next:Gi,error:_r,complete:Gi},xr=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function yr(a){return a}function mr(a){return a.length===0?yr:a.length===1?a[0]:function(e){return a.reduce(function(i,n){return n(i)},e)}}var Wi=function(){function a(t){t&&(this._subscribe=t)}return a.prototype.lift=function(t){var e=new a;return e.source=this,e.operator=t,e},a.prototype.subscribe=function(t,e,i){var n=this,s=Er(t)?t:new Xe(t,e,i);return Ut(function(){var r=n,o=r.operator,l=r.source;s.add(o?o.call(s,l):l?n._subscribe(s):n._trySubscribe(s))}),s},a.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},a.prototype.forEach=function(t,e){var i=this;return e=Bi(e),new e(function(n,s){var r=new Xe({next:function(o){try{t(o)}catch(l){s(l),r.unsubscribe()}},error:s,complete:n});i.subscribe(r)})},a.prototype._subscribe=function(t){var e;return(e=this.source)===null||e===void 0?void 0:e.subscribe(t)},a.prototype[xr]=function(){return this},a.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return mr(t)(this)},a.prototype.toPromise=function(t){var e=this;return t=Bi(t),new t(function(i,n){var s;e.subscribe(function(r){return s=r},function(r){return n(r)},function(){return i(s)})})},a.create=function(t){return new a(t)},a}();function Bi(a){var t;return(t=a??ur.Promise)!==null&&t!==void 0?t:Promise}function Sr(a){return a&&at(a.next)&&at(a.error)&&at(a.complete)}function Er(a){return a&&a instanceof sn||Sr(a)&&nn(a)}var Cr=tn(function(a){return function(){a(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Ne=function(a){se(t,a);function t(){var e=a.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return t.prototype.lift=function(e){var i=new Yi(this,this);return i.operator=e,i},t.prototype._throwIfClosed=function(){if(this.closed)throw new Cr},t.prototype.next=function(e){var i=this;Ut(function(){var n,s;if(i._throwIfClosed(),!i.isStopped){i.currentObservers||(i.currentObservers=Array.from(i.observers));try{for(var r=Ge(i.currentObservers),o=r.next();!o.done;o=r.next()){var l=o.value;l.next(e)}}catch(c){n={error:c}}finally{try{o&&!o.done&&(s=r.return)&&s.call(r)}finally{if(n)throw n.error}}}})},t.prototype.error=function(e){var i=this;Ut(function(){if(i._throwIfClosed(),!i.isStopped){i.hasError=i.isStopped=!0,i.thrownError=e;for(var n=i.observers;n.length;)n.shift().error(e)}})},t.prototype.complete=function(){var e=this;Ut(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var i=e.observers;i.length;)i.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return((e=this.observers)===null||e===void 0?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(e){return this._throwIfClosed(),a.prototype._trySubscribe.call(this,e)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var i=this,n=this,s=n.hasError,r=n.isStopped,o=n.observers;return s||r?en:(this.currentObservers=null,o.push(e),new re(function(){i.currentObservers=null,Ye(o,e)}))},t.prototype._checkFinalizedStatuses=function(e){var i=this,n=i.hasError,s=i.thrownError,r=i.isStopped;n?e.error(s):r&&e.complete()},t.prototype.asObservable=function(){var e=new Wi;return e.source=this,e},t.create=function(e,i){return new Yi(e,i)},t}(Wi),Yi=function(a){se(t,a);function t(e,i){var n=a.call(this)||this;return n.destination=e,n.source=i,n}return t.prototype.next=function(e){var i,n;(n=(i=this.destination)===null||i===void 0?void 0:i.next)===null||n===void 0||n.call(i,e)},t.prototype.error=function(e){var i,n;(n=(i=this.destination)===null||i===void 0?void 0:i.error)===null||n===void 0||n.call(i,e)},t.prototype.complete=function(){var e,i;(i=(e=this.destination)===null||e===void 0?void 0:e.complete)===null||i===void 0||i.call(e)},t.prototype._subscribe=function(e){var i,n;return(n=(i=this.source)===null||i===void 0?void 0:i.subscribe(e))!==null&&n!==void 0?n:en},t}(Ne);const Ir=a=>{const t=a.reduce((e,i)=>Vi(e,i.getGeometry()?.getExtent()??[]),xt())??null;return t&&!Hi(t)?t:null},br="olcOverlayLayerGroupUid";class wr extends ds{featuresAffected;featuresPropertyChanged;constructor(t,e={}){const i=e[Yt]??br;super(t);const n=e.position??20;this.addLayerGroup(i,n),this.featuresAffected=new Ne,this.featuresPropertyChanged=new Ne}getVectorLayer(t){const e=super.getLayer(t);return e instanceof qs?e:null}getVectorSource(t){const e=this.getVectorLayer(t);return e===null?null:e.getSource()}getEndVectorSource(t){const e=this.getVectorSource(t);return cr(e,"source")?e.getSource():e}addFeatures(t,e){const i=this.getEndVectorSource(t);!i||!e.length||(this.removeFeatures(t,e),i.addFeatures(e))}removeFeatures(t,e){const i=this.getEndVectorSource(t);!i||!e.length||e.forEach(n=>{i.hasFeature(n)&&i.removeFeature(n)})}setFeatures(t,e){const i=this.getEndVectorSource(t);i&&(i.clear(),i.addFeatures(e))}getLayerFeaturesExtent(t){return Ir(this.getFeaturesCollection(t)?.getArray()||[])}getFeaturesExtent(){const t=this.layerGroup.getLayers().getArray().reduce((e,i)=>Vi(e,this.getLayerFeaturesExtent(i.get(Yt))??[]),xt());return t&&!Hi(t)?t:null}getFeaturesCollection(t){return this.getEndVectorSource(t)?.getFeaturesCollection()||null}emitFeaturesAffected(t,e,i,n){this.featuresAffected.next({[Yt]:t,reason:e,affected:i,noMoreAffected:n})}setFeaturesProperty(t,e,i,n){e.forEach(s=>{s.set(i,n,!0)}),this.emitFeaturePropertyChanged(t,e,i)}emitFeaturePropertyChanged(t,e,i){this.getLayer(t)?.changed(),this.featuresPropertyChanged.next({[Yt]:t,propertyKey:i,features:e})}getClusterFeatures(t){const e=this.getVectorSource(t);return e?e.getFeatures():null}}export{Qi as F,wr as O,Si as R,qs as V,Ss as a,Rr as b,js as c,vr as d,V as e,Z as f,xi as i,yi as l};
