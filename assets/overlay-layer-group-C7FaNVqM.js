var ji=Object.defineProperty;var $i=(h,t,e)=>t in h?ji(h,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):h[t]=e;var le=(h,t,e)=>$i(h,typeof t!="symbol"?t+"":t,e);import{aG as Le,aH as Qi,aI as tn,o as Gt,w as Ve,J as He,aJ as en,aK as ct,aL as qt,aM as rt,aN as ot,aO as Kt,aP as Ut,aQ as Vt,am as $t,aR as nn,al as Oe,aS as H,aT as Ht,aU as sn,aV as Z,i as st,aW as ft,aX as Zt,aY as kt,aZ as Fi,a_ as rn,ag as X,r as on,a$ as Dt,b0 as an,b1 as ln,b2 as Qt,b3 as Ft,a as be,ap as _t,b4 as hn,b5 as yt,b6 as cn,b7 as Ze,b8 as Jt,b9 as dn,ba as Yt,bb as zt,bc as un,a8 as fn,bd as gn,be as _n,a9 as Je,bf as wt,bg as xn,bh as Wt,bi as Lt,bj as we,bk as pn,bl as ze,bm as je,aj as yn,bn as bt,bo as mn,bp as Sn,ak as In,bq as Cn,br as En,u as ke,l as De,E as Li,bs as Xt,bt as bi,bu as Rn,af as Tn,h as Fn,bv as Ln,bw as bn,K as wn,j as wi,bx as kn,by as Dn,bz as On,x as An,p as vn,bA as Mn,bB as ki,bC as Pn,bD as Gn,ad as Wn,bE as Bn,ae as $e,bF as Nn,V as Yn,a7 as Xn,bG as qn,bH as Kn,bI as te,bJ as Un,bK as Vn,bL as Hn,bM as Zn,g as Di,bN as Oi,bO as Jn,aF as Bt,bP as he,bQ as Qe}from"./background-layer-group-8hBJptBk.js";class Ai{drawCustom(t,e,i,n,s){}drawGeometry(t){}setStyle(t){}drawCircle(t,e,i){}drawFeature(t,e,i){}drawGeometryCollection(t,e,i){}drawLineString(t,e,i){}drawMultiLineString(t,e,i){}drawMultiPoint(t,e,i){}drawMultiPolygon(t,e,i){}drawPoint(t,e,i){}drawPolygon(t,e,i){}drawText(t,e,i){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}}const E={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},Nt=[E.FILL],dt=[E.STROKE],gt=[E.BEGIN_PATH],ti=[E.CLOSE_PATH];class Ot extends Ai{constructor(t,e,i,n){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=n,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const e=this.pixelRatio;return e==1?t:t.map(function(i){return i*e})}appendFlatPointCoordinates(t,e){const i=this.getBufferedMaxExtent(),n=this.tmpCoordinate_,s=this.coordinates;let r=s.length;for(let o=0,a=t.length;o<a;o+=e)n[0]=t[o],n[1]=t[o+1],Le(i,n)&&(s[r++]=n[0],s[r++]=n[1]);return r}appendFlatLineCoordinates(t,e,i,n,s,r){const o=this.coordinates;let a=o.length;const c=this.getBufferedMaxExtent();r&&(e+=n);let l=t[e],d=t[e+1];const u=this.tmpCoordinate_;let f=!0,g,p,_;for(g=e+n;g<i;g+=n)u[0]=t[g],u[1]=t[g+1],_=Qi(c,u),_!==p?(f&&(o[a++]=l,o[a++]=d,f=!1),o[a++]=u[0],o[a++]=u[1]):_===tn.INTERSECTING?(o[a++]=u[0],o[a++]=u[1],f=!1):f=!0,l=u[0],d=u[1],p=_;return(s&&f||g===e+n)&&(o[a++]=l,o[a++]=d),a}drawCustomCoordinates_(t,e,i,n,s){for(let r=0,o=i.length;r<o;++r){const a=i[r],c=this.appendFlatLineCoordinates(t,e,a,n,!1,!1);s.push(c),e=a}return e}drawCustom(t,e,i,n,s){this.beginGeometry(t,e,s);const r=t.getType(),o=t.getStride(),a=this.coordinates.length;let c,l,d,u,f;switch(r){case"MultiPolygon":c=t.getOrientedFlatCoordinates(),u=[];const g=t.getEndss();f=0;for(let p=0,_=g.length;p<_;++p){const x=[];f=this.drawCustomCoordinates_(c,f,g[p],o,x),u.push(x)}this.instructions.push([E.CUSTOM,a,u,t,i,He,s]),this.hitDetectionInstructions.push([E.CUSTOM,a,u,t,n||i,He,s]);break;case"Polygon":case"MultiLineString":d=[],c=r=="Polygon"?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),f=this.drawCustomCoordinates_(c,0,t.getEnds(),o,d),this.instructions.push([E.CUSTOM,a,d,t,i,Ve,s]),this.hitDetectionInstructions.push([E.CUSTOM,a,d,t,n||i,Ve,s]);break;case"LineString":case"Circle":c=t.getFlatCoordinates(),l=this.appendFlatLineCoordinates(c,0,c.length,o,!1,!1),this.instructions.push([E.CUSTOM,a,l,t,i,Gt,s]),this.hitDetectionInstructions.push([E.CUSTOM,a,l,t,n||i,Gt,s]);break;case"MultiPoint":c=t.getFlatCoordinates(),l=this.appendFlatPointCoordinates(c,o),l>a&&(this.instructions.push([E.CUSTOM,a,l,t,i,Gt,s]),this.hitDetectionInstructions.push([E.CUSTOM,a,l,t,n||i,Gt,s]));break;case"Point":c=t.getFlatCoordinates(),this.coordinates.push(c[0],c[1]),l=this.coordinates.length,this.instructions.push([E.CUSTOM,a,l,t,i,void 0,s]),this.hitDetectionInstructions.push([E.CUSTOM,a,l,t,n||i,void 0,s]);break}this.endGeometry(e)}beginGeometry(t,e,i){this.beginGeometryInstruction1_=[E.BEGIN_GEOMETRY,e,0,t,i],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[E.BEGIN_GEOMETRY,e,0,t,i],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;t.reverse();let e;const i=t.length;let n,s,r=-1;for(e=0;e<i;++e)n=t[e],s=n[0],s==E.END_GEOMETRY?r=e:s==E.BEGIN_GEOMETRY&&(n[2]=e,en(this.hitDetectionInstructions,r,e),r=-1)}fillStyleToState(t,e={}){if(t){const i=t.getColor();e.fillPatternScale=i&&typeof i=="object"&&"src"in i?this.pixelRatio:1,e.fillStyle=ct(i||H)}else e.fillStyle=void 0;return e}strokeStyleToState(t,e={}){if(t){const i=t.getColor();e.strokeStyle=ct(i||Ht);const n=t.getLineCap();e.lineCap=n!==void 0?n:qt;const s=t.getLineDash();e.lineDash=s?s.slice():rt;const r=t.getLineDashOffset();e.lineDashOffset=r||ot;const o=t.getLineJoin();e.lineJoin=o!==void 0?o:Kt;const a=t.getWidth();e.lineWidth=a!==void 0?a:Ut;const c=t.getMiterLimit();e.miterLimit=c!==void 0?c:Vt,e.lineWidth>this.maxLineWidth&&(this.maxLineWidth=e.lineWidth,this.bufferedMaxExtent_=null)}else e.strokeStyle=void 0,e.lineCap=void 0,e.lineDash=null,e.lineDashOffset=void 0,e.lineJoin=void 0,e.lineWidth=void 0,e.miterLimit=void 0;return e}setFillStrokeStyle(t,e){const i=this.state;this.fillStyleToState(t,i),this.strokeStyleToState(e,i)}createFill(t){const e=t.fillStyle,i=[E.SET_FILL_STYLE,e];return typeof e!="string"&&i.push(t.fillPatternScale),i}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[E.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,t.lineDash?this.applyPixelRatio(t.lineDash):null,t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){const i=t.fillStyle;(typeof i!="string"||t.currentFillStyle!=i)&&(i!==void 0&&this.instructions.push(e.call(this,t)),t.currentFillStyle=i)}updateStrokeStyle(t,e){const i=t.strokeStyle,n=t.lineCap,s=t.lineDash,r=t.lineDashOffset,o=t.lineJoin,a=t.lineWidth,c=t.miterLimit;(t.currentStrokeStyle!=i||t.currentLineCap!=n||s!=t.currentLineDash&&!$t(t.currentLineDash,s)||t.currentLineDashOffset!=r||t.currentLineJoin!=o||t.currentLineWidth!=a||t.currentMiterLimit!=c)&&(i!==void 0&&e.call(this,t),t.currentStrokeStyle=i,t.currentLineCap=n,t.currentLineDash=s,t.currentLineDashOffset=r,t.currentLineJoin=o,t.currentLineWidth=a,t.currentMiterLimit=c)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const e=[E.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=nn(this.maxExtent),this.maxLineWidth>0)){const t=this.resolution*(this.maxLineWidth+1)/2;Oe(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class zn extends Ot{constructor(t,e,i,n){super(t,e,i,n),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e,i){if(!this.image_||this.maxExtent&&!Le(this.maxExtent,t.getFlatCoordinates()))return;this.beginGeometry(t,e,i);const n=t.getFlatCoordinates(),s=t.getStride(),r=this.coordinates.length,o=this.appendFlatPointCoordinates(n,s);this.instructions.push([E.DRAW_IMAGE,r,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([E.DRAW_IMAGE,r,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(t,e,i){if(!this.image_)return;this.beginGeometry(t,e,i);const n=t.getFlatCoordinates(),s=[];for(let a=0,c=n.length;a<c;a+=t.getStride())(!this.maxExtent||Le(this.maxExtent,n.slice(a,a+2)))&&s.push(n[a],n[a+1]);const r=this.coordinates.length,o=this.appendFlatPointCoordinates(s,2);this.instructions.push([E.DRAW_IMAGE,r,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([E.DRAW_IMAGE,r,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){const i=t.getAnchor(),n=t.getSize(),s=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=n[1],this.opacity_=t.getOpacity(),this.originX_=s[0],this.originY_=s[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=n[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}class jn extends Ot{constructor(t,e,i,n){super(t,e,i,n)}drawFlatCoordinates_(t,e,i,n){const s=this.coordinates.length,r=this.appendFlatLineCoordinates(t,e,i,n,!1,!1),o=[E.MOVE_TO_LINE_TO,s,r];return this.instructions.push(o),this.hitDetectionInstructions.push(o),i}drawLineString(t,e,i){const n=this.state,s=n.strokeStyle,r=n.lineWidth;if(s===void 0||r===void 0)return;this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(t,e,i),this.hitDetectionInstructions.push([E.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,rt,ot],gt);const o=t.getFlatCoordinates(),a=t.getStride();this.drawFlatCoordinates_(o,0,o.length,a),this.hitDetectionInstructions.push(dt),this.endGeometry(e)}drawMultiLineString(t,e,i){const n=this.state,s=n.strokeStyle,r=n.lineWidth;if(s===void 0||r===void 0)return;this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(t,e,i),this.hitDetectionInstructions.push([E.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,rt,ot],gt);const o=t.getEnds(),a=t.getFlatCoordinates(),c=t.getStride();let l=0;for(let d=0,u=o.length;d<u;++d)l=this.drawFlatCoordinates_(a,l,o[d],c);this.hitDetectionInstructions.push(dt),this.endGeometry(e)}finish(){const t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(dt),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(dt),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(gt)}}class ei extends Ot{constructor(t,e,i,n){super(t,e,i,n)}drawFlatCoordinatess_(t,e,i,n){const s=this.state,r=s.fillStyle!==void 0,o=s.strokeStyle!==void 0,a=i.length;this.instructions.push(gt),this.hitDetectionInstructions.push(gt);for(let c=0;c<a;++c){const l=i[c],d=this.coordinates.length,u=this.appendFlatLineCoordinates(t,e,l,n,!0,!o),f=[E.MOVE_TO_LINE_TO,d,u];this.instructions.push(f),this.hitDetectionInstructions.push(f),o&&(this.instructions.push(ti),this.hitDetectionInstructions.push(ti)),e=l}return r&&(this.instructions.push(Nt),this.hitDetectionInstructions.push(Nt)),o&&(this.instructions.push(dt),this.hitDetectionInstructions.push(dt)),e}drawCircle(t,e,i){const n=this.state,s=n.fillStyle,r=n.strokeStyle;if(s===void 0&&r===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([E.SET_FILL_STYLE,H]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([E.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,rt,ot]);const o=t.getFlatCoordinates(),a=t.getStride(),c=this.coordinates.length;this.appendFlatLineCoordinates(o,0,o.length,a,!1,!1);const l=[E.CIRCLE,c];this.instructions.push(gt,l),this.hitDetectionInstructions.push(gt,l),n.fillStyle!==void 0&&(this.instructions.push(Nt),this.hitDetectionInstructions.push(Nt)),n.strokeStyle!==void 0&&(this.instructions.push(dt),this.hitDetectionInstructions.push(dt)),this.endGeometry(e)}drawPolygon(t,e,i){const n=this.state,s=n.fillStyle,r=n.strokeStyle;if(s===void 0&&r===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([E.SET_FILL_STYLE,H]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([E.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,rt,ot]);const o=t.getEnds(),a=t.getOrientedFlatCoordinates(),c=t.getStride();this.drawFlatCoordinatess_(a,0,o,c),this.endGeometry(e)}drawMultiPolygon(t,e,i){const n=this.state,s=n.fillStyle,r=n.strokeStyle;if(s===void 0&&r===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([E.SET_FILL_STYLE,H]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([E.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,rt,ot]);const o=t.getEndss(),a=t.getOrientedFlatCoordinates(),c=t.getStride();let l=0;for(let d=0,u=o.length;d<u;++d)l=this.drawFlatCoordinatess_(a,l,o[d],c);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(t!==0){const e=this.coordinates;for(let i=0,n=e.length;i<n;++i)e[i]=sn(e[i],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;t.fillStyle!==void 0&&this.updateFillStyle(t,this.createFill),t.strokeStyle!==void 0&&this.updateStrokeStyle(t,this.applyStroke)}}function $n(h,t,e,i,n){const s=[];let r=e,o=0,a=t.slice(e,2);for(;o<h&&r+n<i;){const[c,l]=a.slice(-2),d=t[r+n],u=t[r+n+1],f=Math.sqrt((d-c)*(d-c)+(u-l)*(u-l));if(o+=f,o>=h){const g=(h-o+f)/f,p=Z(c,d,g),_=Z(l,u,g);a.push(p,_),s.push(a),a=[p,_],o==h&&(r+=n),o=0}else if(o<h)a.push(t[r+n],t[r+n+1]),r+=n;else{const g=f-o,p=Z(c,d,g/f),_=Z(l,u,g/f);a.push(p,_),s.push(a),a=[p,_],o=0,r+=n}}return o>0&&s.push(a),s}function Qn(h,t,e,i,n){let s=e,r=e,o=0,a=0,c=e,l,d,u,f,g,p,_,x,y,I;for(d=e;d<i;d+=n){const m=t[d],C=t[d+1];g!==void 0&&(y=m-g,I=C-p,f=Math.sqrt(y*y+I*I),_!==void 0&&(a+=u,l=Math.acos((_*y+x*I)/(u*f)),l>h&&(a>o&&(o=a,s=c,r=d),a=0,c=d-n)),u=f,_=y,x=I),g=m,p=C}return a+=f,a>o?[c,d]:[s,r]}const jt={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class ts extends Ot{constructor(t,e,i,n){super(t,e,i,n),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textKeepUpright_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[H]={fillStyle:H},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e,i){const n=this.textFillState_,s=this.textStrokeState_,r=this.textState_;if(this.text_===""||!r||!n&&!s)return;const o=this.coordinates;let a=o.length;const c=t.getType();let l=null,d=t.getStride();if(r.placement==="line"&&(c=="LineString"||c=="MultiLineString"||c=="Polygon"||c=="MultiPolygon")){if(!st(this.maxExtent,t.getExtent()))return;let u;if(l=t.getFlatCoordinates(),c=="LineString")u=[l.length];else if(c=="MultiLineString")u=t.getEnds();else if(c=="Polygon")u=t.getEnds().slice(0,1);else if(c=="MultiPolygon"){const _=t.getEndss();u=[];for(let x=0,y=_.length;x<y;++x)u.push(_[x][0])}this.beginGeometry(t,e,i);const f=r.repeat,g=f?void 0:r.textAlign;let p=0;for(let _=0,x=u.length;_<x;++_){let y;f?y=$n(f*this.resolution,l,p,u[_],d):y=[l.slice(p,u[_])];for(let I=0,m=y.length;I<m;++I){const C=y[I];let R=0,T=C.length;if(g==null){const F=Qn(r.maxAngle,C,0,C.length,2);R=F[0],T=F[1]}for(let F=R;F<T;F+=d)o.push(C[F],C[F+1]);const b=o.length;p=u[_],this.drawChars_(a,b),a=b}}this.endGeometry(e)}else{let u=r.overflow?null:[];switch(c){case"Point":case"MultiPoint":l=t.getFlatCoordinates();break;case"LineString":l=t.getFlatMidpoint();break;case"Circle":l=t.getCenter();break;case"MultiLineString":l=t.getFlatMidpoints(),d=2;break;case"Polygon":l=t.getFlatInteriorPoint(),r.overflow||u.push(l[2]/this.resolution),d=3;break;case"MultiPolygon":const m=t.getFlatInteriorPoints();l=[];for(let C=0,R=m.length;C<R;C+=3)r.overflow||u.push(m[C+2]/this.resolution),l.push(m[C],m[C+1]);if(l.length===0)return;d=2;break}const f=this.appendFlatPointCoordinates(l,d);if(f===a)return;if(u&&(f-a)/2!==l.length/d){let m=a/2;u=u.filter((C,R)=>{const T=o[(m+R)*2]===l[R*d]&&o[(m+R)*2+1]===l[R*d+1];return T||--m,T})}this.saveTextStates_();const g=r.backgroundFill?this.createFill(this.fillStyleToState(r.backgroundFill)):null,p=r.backgroundStroke?this.createStroke(this.strokeStyleToState(r.backgroundStroke)):null;this.beginGeometry(t,e,i);let _=r.padding;if(_!=ft&&(r.scale[0]<0||r.scale[1]<0)){let m=r.padding[0],C=r.padding[1],R=r.padding[2],T=r.padding[3];r.scale[0]<0&&(C=-C,T=-T),r.scale[1]<0&&(m=-m,R=-R),_=[m,C,R,T]}const x=this.pixelRatio;this.instructions.push([E.DRAW_IMAGE,a,f,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,_==ft?ft:_.map(function(m){return m*x}),g,p,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,u]);const y=1/x,I=g?g.slice(0):null;I&&(I[1]=H),this.hitDetectionInstructions.push([E.DRAW_IMAGE,a,f,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[y,y],NaN,this.declutterMode_,this.declutterImageWithText_,_,I,p,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?H:this.fillKey_,this.textOffsetX_,this.textOffsetY_,u]),this.endGeometry(e)}}saveTextStates_(){const t=this.textStrokeState_,e=this.textState_,i=this.textFillState_,n=this.strokeKey_;t&&(n in this.strokeStates||(this.strokeStates[n]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));const s=this.textKey_;s in this.textStates||(this.textStates[s]={font:e.font,textAlign:e.textAlign||kt,justify:e.justify,textBaseline:e.textBaseline||Zt,scale:e.scale});const r=this.fillKey_;i&&(r in this.fillStates||(this.fillStates[r]={fillStyle:i.fillStyle}))}drawChars_(t,e){const i=this.textStrokeState_,n=this.textState_,s=this.strokeKey_,r=this.textKey_,o=this.fillKey_;this.saveTextStates_();const a=this.pixelRatio,c=jt[n.textBaseline],l=this.textOffsetY_*a,d=this.text_,u=i?i.lineWidth*Math.abs(n.scale[0])/2:0;this.instructions.push([E.DRAW_CHARS,t,e,c,n.overflow,o,n.maxAngle,a,l,s,u*a,d,r,1,this.declutterMode_,this.textKeepUpright_]),this.hitDetectionInstructions.push([E.DRAW_CHARS,t,e,c,n.overflow,o&&H,n.maxAngle,a,l,s,u*a,d,r,1/a,this.declutterMode_,this.textKeepUpright_])}setTextStyle(t,e){let i,n,s;if(!t)this.text_="";else{const r=t.getFill();r?(n=this.textFillState_,n||(n={},this.textFillState_=n),n.fillStyle=ct(r.getColor()||H)):(n=null,this.textFillState_=n);const o=t.getStroke();if(!o)s=null,this.textStrokeState_=s;else{s=this.textStrokeState_,s||(s={},this.textStrokeState_=s);const p=o.getLineDash(),_=o.getLineDashOffset(),x=o.getWidth(),y=o.getMiterLimit();s.lineCap=o.getLineCap()||qt,s.lineDash=p?p.slice():rt,s.lineDashOffset=_===void 0?ot:_,s.lineJoin=o.getLineJoin()||Kt,s.lineWidth=x===void 0?Ut:x,s.miterLimit=y===void 0?Vt:y,s.strokeStyle=ct(o.getColor()||Ht)}i=this.textState_;const a=t.getFont()||Fi;rn(a);const c=t.getScaleArray();i.overflow=t.getOverflow(),i.font=a,i.maxAngle=t.getMaxAngle(),i.placement=t.getPlacement(),i.textAlign=t.getTextAlign(),i.repeat=t.getRepeat(),i.justify=t.getJustify(),i.textBaseline=t.getTextBaseline()||Zt,i.backgroundFill=t.getBackgroundFill(),i.backgroundStroke=t.getBackgroundStroke(),i.padding=t.getPadding()||ft,i.scale=c===void 0?[1,1]:c;const l=t.getOffsetX(),d=t.getOffsetY(),u=t.getRotateWithView(),f=t.getKeepUpright(),g=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=l===void 0?0:l,this.textOffsetY_=d===void 0?0:d,this.textRotateWithView_=u===void 0?!1:u,this.textKeepUpright_=f===void 0?!0:f,this.textRotation_=g===void 0?0:g,this.strokeKey_=s?(typeof s.strokeStyle=="string"?s.strokeStyle:X(s.strokeStyle))+s.lineCap+s.lineDashOffset+"|"+s.lineWidth+s.lineJoin+s.miterLimit+"["+s.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.repeat||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=n&&n.fillStyle?typeof n.fillStyle=="string"?n.fillStyle:"|"+X(n.fillStyle):""}this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}const es={Circle:ei,Default:Ot,Image:zn,LineString:jn,Polygon:ei,Text:ts};class is{constructor(t,e,i,n){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=n,this.resolution_=i,this.buildersByZIndex_={}}finish(){const t={};for(const e in this.buildersByZIndex_){t[e]=t[e]||{};const i=this.buildersByZIndex_[e];for(const n in i){const s=i[n].finish();t[e][n]=s}}return t}getBuilder(t,e){const i=t!==void 0?t.toString():"0";let n=this.buildersByZIndex_[i];n===void 0&&(n={},this.buildersByZIndex_[i]=n);let s=n[e];if(s===void 0){const r=es[e];s=new r(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),n[e]=s}return s}}function ns(h,t,e,i){let n=h[t],s=h[t+1],r=0;for(let o=t+i;o<e;o+=i){const a=h[o],c=h[o+1];r+=Math.sqrt((a-n)*(a-n)+(c-s)*(c-s)),n=a,s=c}return r}function ss(h,t,e,i,n,s,r,o,a,c,l,d,u=!0){let f=h[t],g=h[t+1],p=0,_=0,x=0,y=0;function I(){p=f,_=g,t+=i,f=h[t],g=h[t+1],y+=x,x=Math.sqrt((f-p)*(f-p)+(g-_)*(g-_))}do I();while(t<e-i&&y+x<s);let m=x===0?0:(s-y)/x;const C=Z(p,f,m),R=Z(_,g,m),T=t-i,b=y,F=s+o*a(c,n,l);for(;t<e-i&&y+x<F;)I();m=x===0?0:(F-y)/x;const M=Z(p,f,m),A=Z(_,g,m);let k=!1;if(u)if(d){const D=[C,R,M,A];on(D,0,4,2,d,D,D),k=D[0]>D[2]}else k=C>M;const v=Math.PI,w=[],W=T+i===t;t=T,x=0,y=b,f=h[t],g=h[t+1];let L;if(W){I(),L=Math.atan2(g-_,f-p),k&&(L+=L>0?-v:v);const D=(M+C)/2,O=(A+R)/2;return w[0]=[D,O,(F-s)/2,L,n],w}n=n.replace(/\n/g," ");for(let D=0,O=n.length;D<O;){I();let N=Math.atan2(g-_,f-p);if(k&&(N+=N>0?-v:v),L!==void 0){let z=N-L;if(z+=z>v?-2*v:z<-v?2*v:0,Math.abs(z)>r)return null}L=N;const P=D;let B=0;for(;D<O;++D){const z=k?O-D-1:D,At=o*a(c,n[z],l);if(t+i<e&&y+x<s+B+At/2)break;B+=At}if(D===P)continue;const S=k?n.substring(O-P,O-D):n.substring(P,D);m=x===0?0:(s+B/2-y)/x;const mt=Z(p,f,m),St=Z(_,g,m);w.push([mt,St,B/2,N,S]),s+=B}return w}const xt=_t(),at=[],it=[],nt=[],lt=[];function ii(h){return h[3].declutterBox}const ni=new RegExp("[֑-ࣿיִ-﷿ﹰ-ﻼࠀ-࿿-]");function ce(h,t){return t==="start"?t=ni.test(h)?"right":"left":t==="end"&&(t=ni.test(h)?"left":"right"),jt[t]}function rs(h,t,e){return e>0&&h.push(`
`,""),h.push(t,""),h}function os(h,t,e){return e%2===0&&(h+=t),h}class as{constructor(t,e,i,n,s){this.overlaps=i,this.pixelRatio=e,this.resolution=t,this.alignAndScaleFill_,this.instructions=n.instructions,this.coordinates=n.coordinates,this.coordinateCache_={},this.renderedTransform_=Dt(),this.hitDetectionInstructions=n.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=n.fillStates||{},this.strokeStates=n.strokeStates||{},this.textStates=n.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=s?new an:null}getZIndexContext(){return this.zIndexContext_}createLabel(t,e,i,n){const s=t+e+i+n;if(this.labels_[s])return this.labels_[s];const r=n?this.strokeStates[n]:null,o=i?this.fillStates[i]:null,a=this.textStates[e],c=this.pixelRatio,l=[a.scale[0]*c,a.scale[1]*c],d=a.justify?jt[a.justify]:ce(Array.isArray(t)?t[0]:t,a.textAlign||kt),u=n&&r.lineWidth?r.lineWidth:0,f=Array.isArray(t)?t:String(t).split(`
`).reduce(rs,[]),{width:g,height:p,widths:_,heights:x,lineWidths:y}=ln(a,f),I=g+u,m=[],C=(I+2)*l[0],R=(p+u)*l[1],T={width:C<0?Math.floor(C):Math.ceil(C),height:R<0?Math.floor(R):Math.ceil(R),contextInstructions:m};(l[0]!=1||l[1]!=1)&&m.push("scale",l),n&&(m.push("strokeStyle",r.strokeStyle),m.push("lineWidth",u),m.push("lineCap",r.lineCap),m.push("lineJoin",r.lineJoin),m.push("miterLimit",r.miterLimit),m.push("setLineDash",[r.lineDash]),m.push("lineDashOffset",r.lineDashOffset)),i&&m.push("fillStyle",o.fillStyle),m.push("textBaseline","middle"),m.push("textAlign","center");const b=.5-d;let F=d*I+b*u;const M=[],A=[];let k=0,v=0,w=0,W=0,L;for(let D=0,O=f.length;D<O;D+=2){const N=f[D];if(N===`
`){v+=k,k=0,F=d*I+b*u,++W;continue}const P=f[D+1]||a.font;P!==L&&(n&&M.push("font",P),i&&A.push("font",P),L=P),k=Math.max(k,x[w]);const B=[N,F+b*_[w]+d*(_[w]-y[W]),.5*(u+k)+v];F+=_[w],n&&M.push("strokeText",B),i&&A.push("fillText",B),++w}return Array.prototype.push.apply(m,M),Array.prototype.push.apply(m,A),this.labels_[s]=T,T}replayTextBackground_(t,e,i,n,s,r,o){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,i),t.lineTo.apply(t,n),t.lineTo.apply(t,s),t.lineTo.apply(t,e),r&&(this.alignAndScaleFill_=r[2],t.fillStyle=r[1],this.fill_(t)),o&&(this.setStrokeStyle_(t,o),t.stroke())}calculateImageOrLabelDimensions_(t,e,i,n,s,r,o,a,c,l,d,u,f,g,p,_){o*=u[0],a*=u[1];let x=i-o,y=n-a;const I=s+c>t?t-c:s,m=r+l>e?e-l:r,C=g[3]+I*u[0]+g[1],R=g[0]+m*u[1]+g[2],T=x-g[3],b=y-g[0];(p||d!==0)&&(at[0]=T,lt[0]=T,at[1]=b,it[1]=b,it[0]=T+C,nt[0]=it[0],nt[1]=b+R,lt[1]=nt[1]);let F;return d!==0?(F=Qt(Dt(),i,n,1,1,d,-i,-n),Ft(F,at),Ft(F,it),Ft(F,nt),Ft(F,lt),be(Math.min(at[0],it[0],nt[0],lt[0]),Math.min(at[1],it[1],nt[1],lt[1]),Math.max(at[0],it[0],nt[0],lt[0]),Math.max(at[1],it[1],nt[1],lt[1]),xt)):be(Math.min(T,T+C),Math.min(b,b+R),Math.max(T,T+C),Math.max(b,b+R),xt),f&&(x=Math.round(x),y=Math.round(y)),{drawImageX:x,drawImageY:y,drawImageW:I,drawImageH:m,originX:c,originY:l,declutterBox:{minX:xt[0],minY:xt[1],maxX:xt[2],maxY:xt[3],value:_},canvasTransform:F,scale:u}}replayImageOrLabel_(t,e,i,n,s,r,o){const a=!!(r||o),c=n.declutterBox,l=o?o[2]*n.scale[0]/2:0;return c.minX-l<=e[0]&&c.maxX+l>=0&&c.minY-l<=e[1]&&c.maxY+l>=0&&(a&&this.replayTextBackground_(t,at,it,nt,lt,r,o),hn(t,n.canvasTransform,s,i,n.originX,n.originY,n.drawImageW,n.drawImageH,n.drawImageX,n.drawImageY,n.scale)),!0}fill_(t){const e=this.alignAndScaleFill_;if(e){const i=Ft(this.renderedTransform_,[0,0]),n=512*this.pixelRatio;t.save(),t.translate(i[0]%n,i[1]%n),e!==1&&t.scale(e,e),t.rotate(this.viewRotation_)}t.fill(),e&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6])}drawLabelWithPointPlacement_(t,e,i,n){const s=this.textStates[e],r=this.createLabel(t,e,n,i),o=this.strokeStates[i],a=this.pixelRatio,c=ce(Array.isArray(t)?t[0]:t,s.textAlign||kt),l=jt[s.textBaseline||Zt],d=o&&o.lineWidth?o.lineWidth:0,u=r.width/a-2*s.scale[0],f=c*u+2*(.5-c)*d,g=l*r.height/a+2*(.5-l)*d;return{label:r,anchorX:f,anchorY:g}}execute_(t,e,i,n,s,r,o,a){const c=this.zIndexContext_;let l;this.pixelCoordinates_&&$t(i,this.renderedTransform_)?l=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),l=yt(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),cn(this.renderedTransform_,i));let d=0;const u=n.length;let f=0,g,p,_,x,y,I,m,C,R,T,b,F,M,A=0,k=0;const v=this.coordinateCache_,w=this.viewRotation_,W=Math.round(Math.atan2(-i[1],i[0])*1e12)/1e12,L={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:w},D=this.instructions!=n||this.overlaps?0:200;let O,N,P,B;for(;d<u;){const S=n[d];switch(S[0]){case E.BEGIN_GEOMETRY:O=S[1],B=S[3],O.getGeometry()?o!==void 0&&!st(o,B.getExtent())?d=S[2]+1:++d:d=S[2],c&&(c.zIndex=S[4]);break;case E.BEGIN_PATH:A>D&&(this.fill_(t),A=0),k>D&&(t.stroke(),k=0),!A&&!k&&(t.beginPath(),y=NaN,I=NaN),++d;break;case E.CIRCLE:f=S[1];const St=l[f],z=l[f+1],At=l[f+2],Bi=l[f+3],ve=At-St,Me=Bi-z,Pe=Math.sqrt(ve*ve+Me*Me);t.moveTo(St+Pe,z),t.arc(St,z,Pe,0,2*Math.PI,!0),++d;break;case E.CLOSE_PATH:t.closePath(),++d;break;case E.CUSTOM:f=S[1],g=S[2];const Ni=S[3],Yi=S[4],Ge=S[5];L.geometry=Ni,L.feature=O,d in v||(v[d]=[]);const It=v[d];Ge?Ge(l,f,g,2,It):(It[0]=l[f],It[1]=l[f+1],It.length=2),c&&(c.zIndex=S[6]),Yi(It,L),++d;break;case E.DRAW_IMAGE:f=S[1],g=S[2],R=S[3],p=S[4],_=S[5];let ee=S[6];const Xi=S[7],qi=S[8],Ki=S[9],We=S[10];let ie=S[11];const Ui=S[12];let vt=S[13];x=S[14]||"declutter";const Ct=S[15];if(!R&&S.length>=20){T=S[19],b=S[20],F=S[21],M=S[22];const q=this.drawLabelWithPointPlacement_(T,b,F,M);R=q.label,S[3]=R;const ut=S[23];p=(q.anchorX-ut)*this.pixelRatio,S[4]=p;const K=S[24];_=(q.anchorY-K)*this.pixelRatio,S[5]=_,ee=R.height,S[6]=ee,vt=R.width,S[13]=vt}let ne;S.length>25&&(ne=S[25]);let se,Mt,Pt;S.length>17?(se=S[16],Mt=S[17],Pt=S[18]):(se=ft,Mt=null,Pt=null),We&&W?ie+=w:!We&&!W&&(ie-=w);let Vi=0;for(;f<g;f+=2){if(ne&&ne[Vi++]<vt/this.pixelRatio)continue;const q=this.calculateImageOrLabelDimensions_(R.width,R.height,l[f],l[f+1],vt,ee,p,_,qi,Ki,ie,Ui,s,se,!!Mt||!!Pt,O),ut=[t,e,R,q,Xi,Mt,Pt];if(a){let K,j,U;if(Ct){const G=g-f;if(!Ct[G]){Ct[G]={args:ut,declutterMode:x};continue}const Y=Ct[G];K=Y.args,j=Y.declutterMode,delete Ct[G],U=ii(K)}let Q,tt;if(K&&(j!=="declutter"||!a.collides(U))&&(Q=!0),(x!=="declutter"||!a.collides(q.declutterBox))&&(tt=!0),j==="declutter"&&x==="declutter"){const G=Q&&tt;Q=G,tt=G}Q&&(j!=="none"&&a.insert(U),this.replayImageOrLabel_.apply(this,K)),tt&&(x!=="none"&&a.insert(q.declutterBox),this.replayImageOrLabel_.apply(this,ut))}else this.replayImageOrLabel_.apply(this,ut)}++d;break;case E.DRAW_CHARS:const Be=S[1],Ne=S[2],re=S[3],Hi=S[4];M=S[5];const Zi=S[6],Ye=S[7],Xe=S[8];F=S[9];const oe=S[10];T=S[11],Array.isArray(T)&&(T=T.reduce(os,"")),b=S[12];const qe=[S[13],S[13]];x=S[14]||"declutter";const Ji=S[15],ae=this.textStates[b],Et=ae.font,Rt=[ae.scale[0]*Ye,ae.scale[1]*Ye];let Tt;Et in this.widths_?Tt=this.widths_[Et]:(Tt={},this.widths_[Et]=Tt);const Ke=ns(l,Be,Ne,2),Ue=Math.abs(Rt[0])*Ze(Et,T,Tt);if(Hi||Ue<=Ke){const q=this.textStates[b].textAlign,ut=(Ke-Ue)*ce(T,q),K=ss(l,Be,Ne,2,T,ut,Zi,Math.abs(Rt[0]),Ze,Et,Tt,W?0:this.viewRotation_,Ji);t:if(K){const j=[];let U,Q,tt,G,Y;if(F)for(U=0,Q=K.length;U<Q;++U){Y=K[U],tt=Y[4],G=this.createLabel(tt,b,"",F),p=Y[2]+(Rt[0]<0?-oe:oe),_=re*G.height+(.5-re)*2*oe*Rt[1]/Rt[0]-Xe;const et=this.calculateImageOrLabelDimensions_(G.width,G.height,Y[0],Y[1],G.width,G.height,p,_,0,0,Y[3],qe,!1,ft,!1,O);if(a&&x==="declutter"&&a.collides(et.declutterBox))break t;j.push([t,e,G,et,1,null,null])}if(M)for(U=0,Q=K.length;U<Q;++U){Y=K[U],tt=Y[4],G=this.createLabel(tt,b,M,""),p=Y[2],_=re*G.height-Xe;const et=this.calculateImageOrLabelDimensions_(G.width,G.height,Y[0],Y[1],G.width,G.height,p,_,0,0,Y[3],qe,!1,ft,!1,O);if(a&&x==="declutter"&&a.collides(et.declutterBox))break t;j.push([t,e,G,et,1,null,null])}a&&x!=="none"&&a.load(j.map(ii));for(let et=0,zi=j.length;et<zi;++et)this.replayImageOrLabel_.apply(this,j[et])}}++d;break;case E.END_GEOMETRY:if(r!==void 0){O=S[1];const q=r(O,B,x);if(q)return q}++d;break;case E.FILL:D?A++:this.fill_(t),++d;break;case E.MOVE_TO_LINE_TO:for(f=S[1],g=S[2],N=l[f],P=l[f+1],t.moveTo(N,P),y=N+.5|0,I=P+.5|0,f+=2;f<g;f+=2)N=l[f],P=l[f+1],m=N+.5|0,C=P+.5|0,(f==g-2||m!==y||C!==I)&&(t.lineTo(N,P),y=m,I=C);++d;break;case E.SET_FILL_STYLE:this.alignAndScaleFill_=S[2],A&&(this.fill_(t),A=0,k&&(t.stroke(),k=0)),t.fillStyle=S[1],++d;break;case E.SET_STROKE_STYLE:k&&(t.stroke(),k=0),this.setStrokeStyle_(t,S),++d;break;case E.STROKE:D?k++:t.stroke(),++d;break;default:++d;break}}A&&this.fill_(t),k&&t.stroke()}execute(t,e,i,n,s,r){this.viewRotation_=n,this.execute_(t,e,i,this.instructions,s,void 0,void 0,r)}executeHitDetection(t,e,i,n,s){return this.viewRotation_=i,this.execute_(t,[t.canvas.width,t.canvas.height],e,this.hitDetectionInstructions,!0,n,s)}}const pt=["Polygon","Circle","LineString","Image","Text","Default"],vi=["Image","Text"],ls=pt.filter(h=>!vi.includes(h));class hs{constructor(t,e,i,n,s,r,o){this.maxExtent_=t,this.overlaps_=n,this.pixelRatio_=i,this.resolution_=e,this.renderBuffer_=r,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=Dt(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(s,o)}clip(t,e){const i=this.getClipCoords(e);t.beginPath(),t.moveTo(i[0],i[1]),t.lineTo(i[2],i[3]),t.lineTo(i[4],i[5]),t.lineTo(i[6],i[7]),t.clip()}createExecutors_(t,e){for(const i in t){let n=this.executorsByZIndex_[i];n===void 0&&(n={},this.executorsByZIndex_[i]=n);const s=t[i];for(const r in s){const o=s[r];n[r]=new as(this.resolution_,this.pixelRatio_,this.overlaps_,o,e)}}}hasExecutors(t){for(const e in this.executorsByZIndex_){const i=this.executorsByZIndex_[e];for(let n=0,s=t.length;n<s;++n)if(t[n]in i)return!0}return!1}forEachFeatureAtCoordinate(t,e,i,n,s,r){n=Math.round(n);const o=n*2+1,a=Qt(this.hitDetectionTransform_,n+.5,n+.5,1/e,-1/e,-i,-t[0],-t[1]),c=!this.hitDetectionContext_;c&&(this.hitDetectionContext_=Jt(o,o));const l=this.hitDetectionContext_;l.canvas.width!==o||l.canvas.height!==o?(l.canvas.width=o,l.canvas.height=o):c||l.clearRect(0,0,o,o);let d;this.renderBuffer_!==void 0&&(d=_t(),dn(d,t),Oe(d,e*(this.renderBuffer_+n),d));const u=cs(n);let f;function g(C,R,T){const b=l.getImageData(0,0,o,o).data;for(let F=0,M=u.length;F<M;F++)if(b[u[F]]>0){if(!r||T==="none"||f!=="Image"&&f!=="Text"||r.includes(C)){const A=(u[F]-3)/4,k=n-A%o,v=n-(A/o|0),w=s(C,R,k*k+v*v);if(w)return w}l.clearRect(0,0,o,o);break}}const p=Object.keys(this.executorsByZIndex_).map(Number);p.sort(Yt);let _,x,y,I,m;for(_=p.length-1;_>=0;--_){const C=p[_].toString();for(y=this.executorsByZIndex_[C],x=pt.length-1;x>=0;--x)if(f=pt[x],I=y[f],I!==void 0&&(m=I.executeHitDetection(l,a,i,g,d),m))return m}}getClipCoords(t){const e=this.maxExtent_;if(!e)return null;const i=e[0],n=e[1],s=e[2],r=e[3],o=[i,n,i,r,s,r,s,n];return yt(o,0,8,2,t,o),o}isEmpty(){return zt(this.executorsByZIndex_)}execute(t,e,i,n,s,r,o){const a=Object.keys(this.executorsByZIndex_).map(Number);a.sort(o?un:Yt),r=r||pt;const c=pt.length;for(let l=0,d=a.length;l<d;++l){const u=a[l].toString(),f=this.executorsByZIndex_[u];for(let g=0,p=r.length;g<p;++g){const _=r[g],x=f[_];if(x!==void 0){const y=o===null?void 0:x.getZIndexContext(),I=y?y.getContext():t,m=this.maxExtent_&&_!=="Image"&&_!=="Text";if(m&&(I.save(),this.clip(I,i)),!y||_==="Text"||_==="Image"?x.execute(I,e,i,n,s,o):y.pushFunction(C=>x.execute(C,e,i,n,s,o)),m&&I.restore(),y){y.offset();const C=a[l]*c+g;this.deferredZIndexContexts_[C]||(this.deferredZIndexContexts_[C]=[]),this.deferredZIndexContexts_[C].push(y)}}}}this.renderedContext_=t}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){const t=this.deferredZIndexContexts_,e=Object.keys(t).map(Number).sort(Yt);for(let i=0,n=e.length;i<n;++i)t[e[i]].forEach(s=>{s.draw(this.renderedContext_),s.clear()}),t[e[i]].length=0}}const de={};function cs(h){if(de[h]!==void 0)return de[h];const t=h*2+1,e=h*h,i=new Array(e+1);for(let s=0;s<=h;++s)for(let r=0;r<=h;++r){const o=s*s+r*r;if(o>e)break;let a=i[o];a||(a=[],i[o]=a),a.push(((h+s)*t+(h+r))*4+3),s>0&&a.push(((h-s)*t+(h+r))*4+3),r>0&&(a.push(((h+s)*t+(h-r))*4+3),s>0&&a.push(((h-s)*t+(h-r))*4+3))}const n=[];for(let s=0,r=i.length;s<r;++s)i[s]&&n.push(...i[s]);return de[h]=n,n}class ds extends Ai{constructor(t,e,i,n,s,r,o){super(),this.context_=t,this.pixelRatio_=e,this.extent_=i,this.transform_=n,this.transformRotation_=n?fn(Math.atan2(n[1],n[0]),10):0,this.viewRotation_=s,this.squaredTolerance_=r,this.userTransform_=o,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=Dt()}drawImages_(t,e,i,n){if(!this.image_)return;const s=yt(t,e,i,n,this.transform_,this.pixelCoordinates_),r=this.context_,o=this.tmpLocalTransform_,a=r.globalAlpha;this.imageOpacity_!=1&&(r.globalAlpha=a*this.imageOpacity_);let c=this.imageRotation_;this.transformRotation_===0&&(c-=this.viewRotation_),this.imageRotateWithView_&&(c+=this.viewRotation_);for(let l=0,d=s.length;l<d;l+=2){const u=s[l]-this.imageAnchorX_,f=s[l+1]-this.imageAnchorY_;if(c!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const g=u+this.imageAnchorX_,p=f+this.imageAnchorY_;Qt(o,g,p,1,1,c,-g,-p),r.save(),r.transform.apply(r,o),r.translate(g,p),r.scale(this.imageScale_[0],this.imageScale_[1]),r.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),r.restore()}else r.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,u,f,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(r.globalAlpha=a)}drawText_(t,e,i,n){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const s=yt(t,e,i,n,this.transform_,this.pixelCoordinates_),r=this.context_;let o=this.textRotation_;for(this.transformRotation_===0&&(o-=this.viewRotation_),this.textRotateWithView_&&(o+=this.viewRotation_);e<i;e+=n){const a=s[e]+this.textOffsetX_,c=s[e+1]+this.textOffsetY_;o!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(r.save(),r.translate(a-this.textOffsetX_,c-this.textOffsetY_),r.rotate(o),r.translate(this.textOffsetX_,this.textOffsetY_),r.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&r.strokeText(this.text_,0,0),this.textFillState_&&r.fillText(this.text_,0,0),r.restore()):(this.textStrokeState_&&r.strokeText(this.text_,a,c),this.textFillState_&&r.fillText(this.text_,a,c))}}moveToLineTo_(t,e,i,n,s){const r=this.context_,o=yt(t,e,i,n,this.transform_,this.pixelCoordinates_);r.moveTo(o[0],o[1]);let a=o.length;s&&(a-=2);for(let c=2;c<a;c+=2)r.lineTo(o[c],o[c+1]);return s&&r.closePath(),i}drawRings_(t,e,i,n){for(let s=0,r=i.length;s<r;++s)e=this.moveToLineTo_(t,e,i[s],n,!0);return e}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!st(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=gn(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],n=e[3]-e[1],s=Math.sqrt(i*i+n*n),r=this.context_;r.beginPath(),r.arc(e[0],e[1],s,0,2*Math.PI),this.fillState_&&r.fill(),this.strokeState_&&r.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break}}drawFeature(t,e){const i=e.getGeometryFunction()(t);i&&(this.setStyle(e),this.drawGeometry(i))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let i=0,n=e.length;i<n;++i)this.drawGeometry(e[i])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!st(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(i,0,i.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(st(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,n=t.getFlatCoordinates();let s=0;const r=t.getEnds(),o=t.getStride();i.beginPath();for(let a=0,c=r.length;a<c;++a)s=this.moveToLineTo_(n,s,r[a],o,!1);i.stroke()}if(this.text_!==""){const i=t.getFlatMidpoints();this.drawText_(i,0,i.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!st(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!st(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getOrientedFlatCoordinates();let n=0;const s=t.getEndss(),r=t.getStride();e.beginPath();for(let o=0,a=s.length;o<a;++o){const c=s[o];n=this.drawRings_(i,n,c,r)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,i=this.contextFillState_;i?i.fillStyle!=t.fillStyle&&(i.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=t.lineCap&&(i.lineCap=t.lineCap,e.lineCap=t.lineCap),$t(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash),i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),i.lineJoin!=t.lineJoin&&(i.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),i.lineWidth!=t.lineWidth&&(i.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),i.miterLimit!=t.miterLimit&&(i.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,i=this.contextTextState_,n=t.textAlign?t.textAlign:kt;i?(i.font!=t.font&&(i.font=t.font,e.font=t.font),i.textAlign!=n&&(i.textAlign=n,e.textAlign=n),i.textBaseline!=t.textBaseline&&(i.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=n,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:n,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(!t)this.fillState_=null;else{const i=t.getColor();this.fillState_={fillStyle:ct(i||H)}}if(!e)this.strokeState_=null;else{const i=e.getColor(),n=e.getLineCap(),s=e.getLineDash(),r=e.getLineDashOffset(),o=e.getLineJoin(),a=e.getWidth(),c=e.getMiterLimit(),l=s||rt;this.strokeState_={lineCap:n!==void 0?n:qt,lineDash:this.pixelRatio_===1?l:l.map(d=>d*this.pixelRatio_),lineDashOffset:(r||ot)*this.pixelRatio_,lineJoin:o!==void 0?o:Kt,lineWidth:(a!==void 0?a:Ut)*this.pixelRatio_,miterLimit:c!==void 0?c:Vt,strokeStyle:ct(i||Ht)}}}setImageStyle(t){let e;if(!t||!(e=t.getSize())){this.image_=null;return}const i=t.getPixelRatio(this.pixelRatio_),n=t.getAnchor(),s=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=n[0]*i,this.imageAnchorY_=n[1]*i,this.imageHeight_=e[1]*i,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=s[0],this.imageOriginY_=s[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const r=t.getScaleArray();this.imageScale_=[r[0]*this.pixelRatio_/i,r[1]*this.pixelRatio_/i],this.imageWidth_=e[0]*i}setTextStyle(t){if(!t)this.text_="";else{const e=t.getFill();if(!e)this.textFillState_=null;else{const f=e.getColor();this.textFillState_={fillStyle:ct(f||H)}}const i=t.getStroke();if(!i)this.textStrokeState_=null;else{const f=i.getColor(),g=i.getLineCap(),p=i.getLineDash(),_=i.getLineDashOffset(),x=i.getLineJoin(),y=i.getWidth(),I=i.getMiterLimit();this.textStrokeState_={lineCap:g!==void 0?g:qt,lineDash:p||rt,lineDashOffset:_||ot,lineJoin:x!==void 0?x:Kt,lineWidth:y!==void 0?y:Ut,miterLimit:I!==void 0?I:Vt,strokeStyle:ct(f||Ht)}}const n=t.getFont(),s=t.getOffsetX(),r=t.getOffsetY(),o=t.getRotateWithView(),a=t.getRotation(),c=t.getScaleArray(),l=t.getText(),d=t.getTextAlign(),u=t.getTextBaseline();this.textState_={font:n!==void 0?n:Fi,textAlign:d!==void 0?d:kt,textBaseline:u!==void 0?u:Zt},this.text_=l!==void 0?Array.isArray(l)?l.reduce((f,g,p)=>f+=p%2?" ":g,""):l:"",this.textOffsetX_=s!==void 0?this.pixelRatio_*s:0,this.textOffsetY_=r!==void 0?this.pixelRatio_*r:0,this.textRotateWithView_=o!==void 0?o:!1,this.textRotation_=a!==void 0?a:0,this.textScale_=[this.pixelRatio_*c[0],this.pixelRatio_*c[1]]}}}const $=.5;function us(h,t,e,i,n,s,r,o,a){const c=n,l=h[0]*$,d=h[1]*$,u=Jt(l,d);u.imageSmoothingEnabled=!1;const f=u.canvas,g=new ds(u,$,n,null,r,o,null),p=e.length,_=Math.floor((256*256*256-1)/p),x={};for(let I=1;I<=p;++I){const m=e[I-1],C=m.getStyleFunction()||i;if(!C)continue;let R=C(m,s);if(!R)continue;Array.isArray(R)||(R=[R]);const b=(I*_).toString(16).padStart(7,"#00000");for(let F=0,M=R.length;F<M;++F){const A=R[F],k=A.getGeometryFunction()(m);if(!k||!st(c,k.getExtent()))continue;const v=A.clone(),w=v.getFill();w&&w.setColor(b);const W=v.getStroke();W&&(W.setColor(b),W.setLineDash(null)),v.setText(void 0);const L=A.getImage();if(L){const P=L.getImageSize();if(!P)continue;const B=Jt(P[0],P[1],void 0,{alpha:!1}),S=B.canvas;B.fillStyle=b,B.fillRect(0,0,S.width,S.height),v.setImage(new _n({img:S,anchor:L.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:L.getOrigin(),opacity:1,size:L.getSize(),scale:L.getScale(),rotation:L.getRotation(),rotateWithView:L.getRotateWithView()}))}const D=v.getZIndex()||0;let O=x[D];O||(O={},x[D]=O,O.Polygon=[],O.Circle=[],O.LineString=[],O.Point=[]);const N=k.getType();if(N==="GeometryCollection"){const P=k.getGeometriesArrayRecursive();for(let B=0,S=P.length;B<S;++B){const mt=P[B];O[mt.getType().replace("Multi","")].push(mt,v)}}else O[N.replace("Multi","")].push(k,v)}}const y=Object.keys(x).map(Number).sort(Yt);for(let I=0,m=y.length;I<m;++I){const C=x[y[I]];for(const R in C){const T=C[R];for(let b=0,F=T.length;b<F;b+=2){g.setStyle(T[b+1]);for(let M=0,A=t.length;M<A;++M)g.setTransform(t[M]),g.drawGeometry(T[b])}}}return u.getImageData(0,0,f.width,f.height)}function fs(h,t,e){const i=[];if(e){const n=Math.floor(Math.round(h[0])*$),s=Math.floor(Math.round(h[1])*$),r=(Je(n,0,e.width-1)+Je(s,0,e.height-1)*e.width)*4,o=e.data[r],a=e.data[r+1],l=e.data[r+2]+256*(a+256*o),d=Math.floor((256*256*256-1)/t.length);l&&l%d===0&&i.push(t[l/d-1])}return i}const gs=.5,Mi={Point:Cs,LineString:ms,Polygon:Rs,MultiPoint:Es,MultiLineString:Ss,MultiPolygon:Is,GeometryCollection:ys,Circle:xs};function _s(h,t){return parseInt(X(h),10)-parseInt(X(t),10)}function si(h,t){const e=Pi(h,t);return e*e}function Pi(h,t){return gs*h/t}function xs(h,t,e,i,n){const s=e.getFill(),r=e.getStroke();if(s||r){const a=h.getBuilder(e.getZIndex(),"Circle");a.setFillStrokeStyle(s,r),a.drawCircle(t,i,n)}const o=e.getText();if(o&&o.getText()){const a=h.getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,i)}}function ri(h,t,e,i,n,s,r,o){const a=[],c=e.getImage();if(c){let u=!0;const f=c.getImageState();f==wt.LOADED||f==wt.ERROR?u=!1:f==wt.IDLE&&c.load(),u&&a.push(c.ready())}const l=e.getFill();l&&l.loading()&&a.push(l.ready());const d=a.length>0;return d&&Promise.all(a).then(()=>n(null)),ps(h,t,e,i,s,r,o),d}function ps(h,t,e,i,n,s,r){const o=e.getGeometryFunction()(t);if(!o)return;const a=o.simplifyTransformed(i,n);if(e.getRenderer())Gi(h,a,e,t,r);else{const l=Mi[a.getType()];l(h,a,e,t,r,s)}}function Gi(h,t,e,i,n){if(t.getType()=="GeometryCollection"){const r=t.getGeometries();for(let o=0,a=r.length;o<a;++o)Gi(h,r[o],e,i,n);return}h.getBuilder(e.getZIndex(),"Default").drawCustom(t,i,e.getRenderer(),e.getHitDetectionRenderer(),n)}function ys(h,t,e,i,n,s){const r=t.getGeometriesArray();let o,a;for(o=0,a=r.length;o<a;++o){const c=Mi[r[o].getType()];c(h,r[o],e,i,n,s)}}function ms(h,t,e,i,n){const s=e.getStroke();if(s){const o=h.getBuilder(e.getZIndex(),"LineString");o.setFillStrokeStyle(null,s),o.drawLineString(t,i,n)}const r=e.getText();if(r&&r.getText()){const o=h.getBuilder(e.getZIndex(),"Text");o.setTextStyle(r),o.drawText(t,i,n)}}function Ss(h,t,e,i,n){const s=e.getStroke();if(s){const o=h.getBuilder(e.getZIndex(),"LineString");o.setFillStrokeStyle(null,s),o.drawMultiLineString(t,i,n)}const r=e.getText();if(r&&r.getText()){const o=h.getBuilder(e.getZIndex(),"Text");o.setTextStyle(r),o.drawText(t,i,n)}}function Is(h,t,e,i,n){const s=e.getFill(),r=e.getStroke();if(r||s){const a=h.getBuilder(e.getZIndex(),"Polygon");a.setFillStrokeStyle(s,r),a.drawMultiPolygon(t,i,n)}const o=e.getText();if(o&&o.getText()){const a=h.getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,i,n)}}function Cs(h,t,e,i,n,s){const r=e.getImage(),o=e.getText(),a=o&&o.getText(),c=s&&r&&a?{}:void 0;if(r){if(r.getImageState()!=wt.LOADED)return;const l=h.getBuilder(e.getZIndex(),"Image");l.setImageStyle(r,c),l.drawPoint(t,i,n)}if(a){const l=h.getBuilder(e.getZIndex(),"Text");l.setTextStyle(o,c),l.drawText(t,i,n)}}function Es(h,t,e,i,n,s){const r=e.getImage(),o=r&&r.getOpacity()!==0,a=e.getText(),c=a&&a.getText(),l=s&&o&&c?{}:void 0;if(o){if(r.getImageState()!=wt.LOADED)return;const d=h.getBuilder(e.getZIndex(),"Image");d.setImageStyle(r,l),d.drawMultiPoint(t,i,n)}if(c){const d=h.getBuilder(e.getZIndex(),"Text");d.setTextStyle(a,l),d.drawText(t,i,n)}}function Rs(h,t,e,i,n){const s=e.getFill(),r=e.getStroke();if(s||r){const a=h.getBuilder(e.getZIndex(),"Polygon");a.setFillStrokeStyle(s,r),a.drawPolygon(t,i,n)}const o=e.getText();if(o&&o.getText()){const a=h.getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,i,n)}}class Ts extends xn{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=_t(),this.wrappedRenderedExtent_=_t(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(t,e,i){const n=e.extent,s=e.viewState,r=s.center,o=s.resolution,a=s.projection,c=s.rotation,l=a.getExtent(),d=this.getLayer().getSource(),u=this.getLayer().getDeclutter(),f=e.pixelRatio,g=e.viewHints,p=!(g[Wt.ANIMATING]||g[Wt.INTERACTING]),_=this.context,x=Math.round(Lt(n)/o*f),y=Math.round(we(n)/o*f),I=d.getWrapX()&&a.canWrapX(),m=I?Lt(l):null,C=I?Math.ceil((n[2]-l[2])/m)+1:1;let R=I?Math.floor((n[0]-l[0])/m):0;do{let T=this.getRenderTransform(r,o,0,f,x,y,R*m);e.declutter&&(T=T.slice(0)),t.execute(_,[_.canvas.width,_.canvas.height],T,c,p,i===void 0?pt:i?vi:ls,i?u&&e.declutter[u]:void 0)}while(++R<C)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=Jt(this.context.canvas.width,this.context.canvas.height,ze))}resetDrawContext_(){if(this.opacity_!==1){const t=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=t,pn(this.context),ze.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(t){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,t,!0)}renderDeferredInternal(t){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(t,e){const i=t.layerStatesArray[t.layerIndex];this.opacity_=i.opacity;const n=t.viewState;this.prepareContainer(t,e);const s=this.context,r=this.replayGroup_;let o=r&&!r.isEmpty();if(!o&&!(this.getLayer().hasListener(je.PRERENDER)||this.getLayer().hasListener(je.POSTRENDER)))return this.container;if(this.setDrawContext_(),this.preRender(s,t),n.projection,this.clipped_=!1,o&&i.extent&&this.clipping){const a=yn(i.extent);o=st(a,t.extent),this.clipped_=o&&!bt(a,t.extent),this.clipped_&&this.clipUnrotated(s,t,a)}return o&&this.renderWorlds(r,t,this.getLayer().getDeclutter()?!1:void 0),!t.declutter&&this.clipped_&&s.restore(),this.postRender(s,t),this.renderedRotation_!==n.rotation&&(this.renderedRotation_=n.rotation,this.hitDetectionImageData_=null),t.declutter||this.resetDrawContext_(),this.container}getFeatures(t){return new Promise(e=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const i=this.frameState.size.slice(),n=this.renderedCenter_,s=this.renderedResolution_,r=this.renderedRotation_,o=this.renderedProjection_,a=this.wrappedRenderedExtent_,c=this.getLayer(),l=[],d=i[0]*$,u=i[1]*$;l.push(this.getRenderTransform(n,s,r,$,d,u,0).slice());const f=c.getSource(),g=o.getExtent();if(f.getWrapX()&&o.canWrapX()&&!bt(g,a)){let p=a[0];const _=Lt(g);let x=0,y;for(;p<g[0];)--x,y=_*x,l.push(this.getRenderTransform(n,s,r,$,d,u,y).slice()),p+=_;for(x=0,p=a[2];p>g[2];)++x,y=_*x,l.push(this.getRenderTransform(n,s,r,$,d,u,y).slice()),p-=_}this.hitDetectionImageData_=us(i,l,this.renderedFeatures_,c.getStyleFunction(),a,s,r,si(s,this.renderedPixelRatio_))}e(fs(t,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(t,e,i,n,s){var u,f;if(!this.replayGroup_)return;const r=e.viewState.resolution,o=e.viewState.rotation,a=this.getLayer(),c={},l=function(g,p,_){const x=X(g),y=c[x];if(y){if(y!==!0&&_<y.distanceSq){if(_===0)return c[x]=!0,s.splice(s.lastIndexOf(y),1),n(g,a,p);y.geometry=p,y.distanceSq=_}}else{if(_===0)return c[x]=!0,n(g,a,p);s.push(c[x]={feature:g,layer:a,geometry:p,distanceSq:_,callback:n})}},d=this.getLayer().getDeclutter();return this.replayGroup_.forEachFeatureAtCoordinate(t,r,o,i,l,d?(f=(u=e.declutter)==null?void 0:u[d])==null?void 0:f.all().map(g=>g.value):null)}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){const e=this.getLayer(),i=e.getSource();if(!i)return!1;const n=t.viewHints[Wt.ANIMATING],s=t.viewHints[Wt.INTERACTING],r=e.getUpdateWhileAnimating(),o=e.getUpdateWhileInteracting();if(this.ready&&!r&&n||!o&&s)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const a=t.extent,c=t.viewState,l=c.projection,d=c.resolution,u=t.pixelRatio,f=e.getRevision(),g=e.getRenderBuffer();let p=e.getRenderOrder();p===void 0&&(p=_s);const _=c.center.slice(),x=Oe(a,g*d),y=x.slice(),I=[x.slice()],m=l.getExtent();if(i.getWrapX()&&l.canWrapX()&&!bt(m,t.extent)){const w=Lt(m),W=Math.max(Lt(x)/2,w);x[0]=m[0]-W,x[2]=m[2]+W,mn(_,l);const L=Sn(I[0],l);L[0]<m[0]&&L[2]<m[2]?I.push([L[0]+w,L[1],L[2]+w,L[3]]):L[0]>m[0]&&L[2]>m[2]&&I.push([L[0]-w,L[1],L[2]-w,L[3]])}if(this.ready&&this.renderedResolution_==d&&this.renderedRevision_==f&&this.renderedRenderOrder_==p&&this.renderedFrameDeclutter_===!!t.declutter&&bt(this.wrappedRenderedExtent_,x))return $t(this.renderedExtent_,y)||(this.hitDetectionImageData_=null,this.renderedExtent_=y),this.renderedCenter_=_,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const C=new is(Pi(d,u),x,d,u);let R;for(let w=0,W=I.length;w<W;++w)i.loadFeatures(I[w],d,l);const T=si(d,u);let b=!0;const F=(w,W)=>{let L;const D=w.getStyleFunction()||e.getStyleFunction();if(D&&(L=D(w,d)),L){const O=this.renderFeature(w,T,L,C,R,this.getLayer().getDeclutter(),W);b=b&&!O}},M=In(x),A=i.getFeaturesInExtent(M);p&&A.sort(p);for(let w=0,W=A.length;w<W;++w)F(A[w],w);this.renderedFeatures_=A,this.ready=b;const k=C.finish(),v=new hs(x,d,u,i.getOverlaps(),k,e.getRenderBuffer(),!!t.declutter);return this.renderedResolution_=d,this.renderedRevision_=f,this.renderedRenderOrder_=p,this.renderedFrameDeclutter_=!!t.declutter,this.renderedExtent_=y,this.wrappedRenderedExtent_=x,this.renderedCenter_=_,this.renderedProjection_=l,this.renderedPixelRatio_=u,this.replayGroup_=v,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,e,i,n,s,r,o){if(!i)return!1;let a=!1;if(Array.isArray(i))for(let c=0,l=i.length;c<l;++c)a=ri(n,t,i[c],e,this.boundHandleStyleImageChange_,s,r,o)||a;else a=ri(n,t,i,e,this.boundHandleStyleImageChange_,s,r,o);return a}}class Fs extends Cn{constructor(t){super(t)}createRenderer(){return new Ts(this)}}let Ls=!1;function bs(h,t,e,i,n,s,r){const o=new XMLHttpRequest;o.open("GET",typeof h=="function"?h(e,i,n):h,!0),t.getType()=="arraybuffer"&&(o.responseType="arraybuffer"),o.withCredentials=Ls,o.onload=function(a){if(!o.status||o.status>=200&&o.status<300){const c=t.getType();try{let l;c=="text"||c=="json"?l=o.responseText:c=="xml"?l=o.responseXML||o.responseText:c=="arraybuffer"&&(l=o.response),l?s(t.readFeatures(l,{extent:e,featureProjection:n}),t.readProjection(l)):r()}catch{r()}}else r()},o.onerror=r,o.send()}function oi(h,t){return function(e,i,n,s,r){bs(h,t,e,i,n,(o,a)=>{this.addFeatures(o),s!==void 0&&s(o)},()=>{this.changed(),r!==void 0&&r()})}}function ws(h,t){return[[-1/0,-1/0,1/0,1/0]]}class Wi extends En{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){const e=t;this.setGeometry(e)}else{const e=t;this.setProperties(e)}}clone(){const t=new Wi(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const i=this.getStyle();return i&&t.setStyle(i),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(ke(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=De(t,Li.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?ks(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function ks(h){if(typeof h=="function")return h;let t;return Array.isArray(h)?t=h:(Xt(typeof h.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),t=[h]),function(){return t}}function Ds(h,t,e,i){const n=[];let s=_t();for(let r=0,o=e.length;r<o;++r){const a=e[r];s=bi(h,t,a[0],i),n.push((s[0]+s[2])/2,(s[1]+s[3])/2),t=a[a.length-1]}return n}function ai(h,t,e,i,n,s,r){let o,a;const c=(e-t)/i;if(c===1)o=t;else if(c===2)o=t,a=n;else if(c!==0){let l=h[t],d=h[t+1],u=0;const f=[0];for(let _=t+i;_<e;_+=i){const x=h[_],y=h[_+1];u+=Math.sqrt((x-l)*(x-l)+(y-d)*(y-d)),f.push(u),l=x,d=y}const g=n*u,p=Rn(f,g);p<0?(a=(g-f[-p-2])/(f[-p-1]-f[-p-2]),o=t+(-p-2)*i):o=t+p*i}r=r>1?r:2,s=s||new Array(r);for(let l=0;l<r;++l)s[l]=o===void 0?NaN:a===void 0?h[o+l]:Z(h[o+l],h[o+i+l],a);return s}function li(h,t,e,i,n,s){if(e==t)return null;let r;if(n<h[t+i-1])return s?(r=h.slice(t,t+i),r[i-1]=n,r):null;if(h[e-1]<n)return s?(r=h.slice(e-i,e),r[i-1]=n,r):null;if(n==h[t+i-1])return h.slice(t,t+i);let o=t/i,a=e/i;for(;o<a;){const u=o+a>>1;n<h[(u+1)*i-1]?a=u:o=u+1}const c=h[o*i-1];if(n==c)return h.slice((o-1)*i,(o-1)*i+i);const l=h[(o+1)*i-1],d=(n-c)/(l-c);r=[];for(let u=0;u<i-1;++u)r.push(Z(h[(o-1)*i+u],h[o*i+u],d));return r.push(n),r}function $s(h,t,e,i,n,s,r){if(r)return li(h,t,e[e.length-1],i,n,s);let o;if(n<h[i-1])return s?(o=h.slice(0,i),o[i-1]=n,o):null;if(h[h.length-1]<n)return s?(o=h.slice(h.length-i),o[i-1]=n,o):null;for(let a=0,c=e.length;a<c;++a){const l=e[a];if(t!=l){if(n<h[t+i-1])return null;if(n<=h[l-1])return li(h,t,l,i,n,!1);t=l}}return null}const hi=Dt();class J{constructor(t,e,i,n,s,r){this.styleFunction,this.extent_,this.id_=r,this.type_=t,this.flatCoordinates_=e,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=i||null,this.properties_=s,this.squaredTolerance_,this.stride_=n,this.simplifiedGeometry_}get(t){return this.properties_[t]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?Tn(this.flatCoordinates_):bi(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const t=Fn(this.getExtent());this.flatInteriorPoints_=Ln(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const t=bn(this.flatCoordinates_,this.ends_),e=Ds(this.flatCoordinates_,0,t,2);this.flatInteriorPoints_=wn(this.flatCoordinates_,0,t,2,e)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=ai(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const t=this.flatCoordinates_;let e=0;const i=this.ends_;for(let n=0,s=i.length;n<s;++n){const r=i[n],o=ai(t,e,r,2,.5);wi(this.flatMidpoints_,o),e=r}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(t){return this}simplifyTransformed(t,e){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(t){t=kn(t);const e=t.getExtent(),i=t.getWorldExtent();if(e&&i){const n=we(i)/we(e);Qt(hi,i[0],i[3],n,-n,0,0,0),yt(this.flatCoordinates_,0,this.flatCoordinates_.length,2,hi,this.flatCoordinates_)}}applyTransform(t){t(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){var t;return new J(this.type_,this.flatCoordinates_.slice(),(t=this.ends_)==null?void 0:t.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=Dn((t,e)=>{if(t===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),e&&this.simplifiedGeometry_.applyTransform(e);const i=this.simplifiedGeometry_.getFlatCoordinates();let n;switch(this.type_){case"LineString":i.length=vn(i,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,t,i,0),n=[i.length];break;case"MultiLineString":n=[],i.length=An(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,t,i,0,n);break;case"Polygon":n=[],i.length=On(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(t),i,0,n);break}return n&&(this.simplifiedGeometry_=new J(this.type_,i,n,2,this.properties_,this.id_)),this.squaredTolerance_=t,this.simplifiedGeometry_}),this}}J.prototype.getFlatCoordinates=J.prototype.getOrientedFlatCoordinates;class ci{constructor(t){this.rbush_=new Mn(t),this.items_={}}insert(t,e){const i={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(i),this.items_[X(e)]=i}load(t,e){const i=new Array(e.length);for(let n=0,s=e.length;n<s;n++){const r=t[n],o=e[n],a={minX:r[0],minY:r[1],maxX:r[2],maxY:r[3],value:o};i[n]=a,this.items_[X(o)]=a}this.rbush_.load(i)}remove(t){const e=X(t),i=this.items_[e];return delete this.items_[e],this.rbush_.remove(i)!==null}update(t,e){const i=this.items_[X(e)],n=[i.minX,i.minY,i.maxX,i.maxY];ki(n,t)||(this.remove(e),this.insert(t,e))}getAll(){return this.rbush_.all().map(function(e){return e.value})}getInExtent(t){const e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map(function(n){return n.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,e){return this.forEach_(this.getInExtent(t),e)}forEach_(t,e){let i;for(let n=0,s=t.length;n<s;n++)if(i=e(t[n]),i)return i;return i}isEmpty(){return zt(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){const e=this.rbush_.toJSON();return be(e.minX,e.minY,e.maxX,e.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(const e in t.items_)this.items_[e]=t.items_[e]}}const V={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};class ht extends Xn{constructor(t,e,i){super(t),this.feature=e,this.features=i}}class Qs extends Pn{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:t.wrapX!==void 0?t.wrapX:!0}),this.on,this.once,this.un,this.loader_=Gn,this.format_=t.format||null,this.overlaps_=t.overlaps===void 0?!0:t.overlaps,this.url_=t.url,t.loader!==void 0?this.loader_=t.loader:this.url_!==void 0&&(Xt(this.format_,"`format` must be set when `url` is set"),this.loader_=oi(this.url_,this.format_)),this.strategy_=t.strategy!==void 0?t.strategy:ws;const e=t.useSpatialIndex!==void 0?t.useSpatialIndex:!0;this.featuresRtree_=e?new ci:null,this.loadedExtentsRtree_=new ci,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let i,n;Array.isArray(t.features)?n=t.features:t.features&&(i=t.features,n=i.getArray()),!e&&i===void 0&&(i=new Wn(n)),n!==void 0&&this.addFeaturesInternal(n),i!==void 0&&this.bindFeaturesCollection_(i)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){const e=X(t);if(!this.addToIndex_(e,t)){this.featuresCollection_&&this.featuresCollection_.remove(t);return}this.setupChangeEvents_(e,t);const i=t.getGeometry();if(i){const n=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(n,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new ht(V.ADDFEATURE,t))}setupChangeEvents_(t,e){e instanceof J||(this.featureChangeKeys_[t]=[De(e,Li.CHANGE,this.handleFeatureChange_,this),De(e,Bn.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(t,e){let i=!0;if(e.getId()!==void 0){const n=String(e.getId());if(!(n in this.idIndex_))this.idIndex_[n]=e;else if(e instanceof J){const s=this.idIndex_[n];s instanceof J?Array.isArray(s)?s.push(e):this.idIndex_[n]=[s,e]:i=!1}else i=!1}return i&&(Xt(!(t in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[t]=e),i}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){const e=[],i=[],n=[];for(let s=0,r=t.length;s<r;s++){const o=t[s],a=X(o);this.addToIndex_(a,o)&&i.push(o)}for(let s=0,r=i.length;s<r;s++){const o=i[s],a=X(o);this.setupChangeEvents_(a,o);const c=o.getGeometry();if(c){const l=c.getExtent();e.push(l),n.push(o)}else this.nullGeometryFeatures_[a]=o}if(this.featuresRtree_&&this.featuresRtree_.load(e,n),this.hasListener(V.ADDFEATURE))for(let s=0,r=i.length;s<r;s++)this.dispatchEvent(new ht(V.ADDFEATURE,i[s]))}bindFeaturesCollection_(t){let e=!1;this.addEventListener(V.ADDFEATURE,function(i){e||(e=!0,t.push(i.feature),e=!1)}),this.addEventListener(V.REMOVEFEATURE,function(i){e||(e=!0,t.remove(i.feature),e=!1)}),t.addEventListener($e.ADD,i=>{e||(e=!0,this.addFeature(i.element),e=!1)}),t.addEventListener($e.REMOVE,i=>{e||(e=!0,this.removeFeature(i.element),e=!1)}),this.featuresCollection_=t}clear(t){if(t){for(const i in this.featureChangeKeys_)this.featureChangeKeys_[i].forEach(ke);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){this.featuresRtree_.forEach(i=>{this.removeFeatureInternal(i)});for(const i in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[i])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const e=new ht(V.CLEAR);this.dispatchEvent(e),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,e){const i=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(i,function(n){const s=n.getGeometry();if(s instanceof J||s.intersectsCoordinate(t))return e(n)})}forEachFeatureInExtent(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureIntersectingExtent(t,e){return this.forEachFeatureInExtent(t,function(i){const n=i.getGeometry();if(n instanceof J||n.intersectsExtent(t)){const s=e(i);if(s)return s}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),zt(this.nullGeometryFeatures_)||wi(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){const e=[];return this.forEachFeatureAtCoordinateDirect(t,function(i){e.push(i)}),e}getFeaturesInExtent(t,e){if(this.featuresRtree_){if(!(e&&e.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);const n=Nn(t,e);return[].concat(...n.map(s=>this.featuresRtree_.getInExtent(s)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,e){const i=t[0],n=t[1];let s=null;const r=[NaN,NaN];let o=1/0;const a=[-1/0,-1/0,1/0,1/0];return e=e||Yn,this.featuresRtree_.forEachInExtent(a,function(c){if(e(c)){const l=c.getGeometry(),d=o;if(o=l instanceof J?0:l.closestPointXY(i,n,r,o),o<d){s=c;const u=Math.sqrt(o);a[0]=i-u,a[1]=n-u,a[2]=i+u,a[3]=n+u}}}),s}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){const e=this.idIndex_[t.toString()];return e!==void 0?e:null}getFeatureByUid(t){const e=this.uidIndex_[t];return e!==void 0?e:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){const e=t.target,i=X(e),n=e.getGeometry();if(!n)i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[i]=e);else{const r=n.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(r,e)):this.featuresRtree_&&this.featuresRtree_.update(r,e)}const s=e.getId();if(s!==void 0){const r=s.toString();this.idIndex_[r]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[r]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[i]=e;this.changed(),this.dispatchEvent(new ht(V.CHANGEFEATURE,e))}hasFeature(t){const e=t.getId();return e!==void 0?e in this.idIndex_:X(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&zt(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(t,e,i){const n=this.loadedExtentsRtree_,s=this.strategy_(t,e,i);for(let r=0,o=s.length;r<o;++r){const a=s[r];n.forEachInExtent(a,function(l){return bt(l.extent,a)})||(++this.loadingExtentsCount_,this.dispatchEvent(new ht(V.FEATURESLOADSTART)),this.loader_.call(this,a,e,i,l=>{--this.loadingExtentsCount_,this.dispatchEvent(new ht(V.FEATURESLOADEND,void 0,l))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new ht(V.FEATURESLOADERROR))}),n.insert(a,{extent:a.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){const e=this.loadedExtentsRtree_,i=e.forEachInExtent(t,function(n){if(ki(n.extent,t))return n});i&&e.remove(i)}removeFeatures(t){let e=!1;for(let i=0,n=t.length;i<n;++i)e=this.removeFeatureInternal(t[i])||e;e&&this.changed()}removeFeature(t){if(!t)return;this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){const e=X(t);if(!(e in this.uidIndex_))return!1;e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t);const i=this.featureChangeKeys_[e];i==null||i.forEach(ke),delete this.featureChangeKeys_[e];const n=t.getId();if(n!==void 0){const s=n.toString(),r=this.idIndex_[s];r===t?delete this.idIndex_[s]:Array.isArray(r)&&(r.splice(r.indexOf(t),1),r.length===1&&(this.idIndex_[s]=r[0]))}return delete this.uidIndex_[e],this.hasListener(V.REMOVEFEATURE)&&this.dispatchEvent(new ht(V.REMOVEFEATURE,t)),!0}removeFromIdIndex_(t){for(const e in this.idIndex_)if(this.idIndex_[e]===t){delete this.idIndex_[e];break}}setLoader(t){this.loader_=t}setUrl(t){Xt(this.format_,"`format` must be set when `url` is set"),this.url_=t,this.setLoader(oi(t,this.format_))}setOverlaps(t){this.overlaps_=t,this.changed()}}var ue,di;function Os(){if(di)return ue;di=1;var h=Object.prototype,t=h.hasOwnProperty;function e(i,n){return i!=null&&t.call(i,n)}return ue=e,ue}var fe,ui;function Ae(){if(ui)return fe;ui=1;var h=qn(),t=Kn(),e="[object Symbol]";function i(n){return typeof n=="symbol"||t(n)&&h(n)==e}return fe=i,fe}var ge,fi;function As(){if(fi)return ge;fi=1;var h=te(),t=Ae(),e=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,i=/^\w*$/;function n(s,r){if(h(s))return!1;var o=typeof s;return o=="number"||o=="symbol"||o=="boolean"||s==null||t(s)?!0:i.test(s)||!e.test(s)||r!=null&&s in Object(r)}return ge=n,ge}var _e,gi;function vs(){if(gi)return _e;gi=1;var h=Un(),t="Expected a function";function e(i,n){if(typeof i!="function"||n!=null&&typeof n!="function")throw new TypeError(t);var s=function(){var r=arguments,o=n?n.apply(this,r):r[0],a=s.cache;if(a.has(o))return a.get(o);var c=i.apply(this,r);return s.cache=a.set(o,c)||a,c};return s.cache=new(e.Cache||h),s}return e.Cache=h,_e=e,_e}var xe,_i;function Ms(){if(_i)return xe;_i=1;var h=vs(),t=500;function e(i){var n=h(i,function(r){return s.size===t&&s.clear(),r}),s=n.cache;return n}return xe=e,xe}var pe,xi;function Ps(){if(xi)return pe;xi=1;var h=Ms(),t=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,e=/\\(\\)?/g,i=h(function(n){var s=[];return n.charCodeAt(0)===46&&s.push(""),n.replace(t,function(r,o,a,c){s.push(a?c.replace(e,"$1"):o||r)}),s});return pe=i,pe}var ye,pi;function Gs(){if(pi)return ye;pi=1;function h(t,e){for(var i=-1,n=t==null?0:t.length,s=Array(n);++i<n;)s[i]=e(t[i],i,t);return s}return ye=h,ye}var me,yi;function Ws(){if(yi)return me;yi=1;var h=Vn(),t=Gs(),e=te(),i=Ae(),n=h?h.prototype:void 0,s=n?n.toString:void 0;function r(o){if(typeof o=="string")return o;if(e(o))return t(o,r)+"";if(i(o))return s?s.call(o):"";var a=o+"";return a=="0"&&1/o==-1/0?"-0":a}return me=r,me}var Se,mi;function Bs(){if(mi)return Se;mi=1;var h=Ws();function t(e){return e==null?"":h(e)}return Se=t,Se}var Ie,Si;function Ns(){if(Si)return Ie;Si=1;var h=te(),t=As(),e=Ps(),i=Bs();function n(s,r){return h(s)?s:t(s,r)?[s]:e(i(s))}return Ie=n,Ie}var Ce,Ii;function Ys(){if(Ii)return Ce;Ii=1;var h=9007199254740991,t=/^(?:0|[1-9]\d*)$/;function e(i,n){var s=typeof i;return n=n??h,!!n&&(s=="number"||s!="symbol"&&t.test(i))&&i>-1&&i%1==0&&i<n}return Ce=e,Ce}var Ee,Ci;function Xs(){if(Ci)return Ee;Ci=1;var h=9007199254740991;function t(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=h}return Ee=t,Ee}var Re,Ei;function qs(){if(Ei)return Re;Ei=1;var h=Ae();function t(e){if(typeof e=="string"||h(e))return e;var i=e+"";return i=="0"&&1/e==-1/0?"-0":i}return Re=t,Re}var Te,Ri;function Ks(){if(Ri)return Te;Ri=1;var h=Ns(),t=Hn(),e=te(),i=Ys(),n=Xs(),s=qs();function r(o,a,c){a=h(a,o);for(var l=-1,d=a.length,u=!1;++l<d;){var f=s(a[l]);if(!(u=o!=null&&c(o,f)))break;o=o[f]}return u||++l!=d?u:(d=o==null?0:o.length,!!d&&n(d)&&i(f,d)&&(e(o)||t(o)))}return Te=r,Te}var Fe,Ti;function Us(){if(Ti)return Fe;Ti=1;var h=Os(),t=Ks();function e(i,n){return i!=null&&t(i,n,h)}return Fe=e,Fe}var Vs=Us();const Hs=Zn(Vs),Zs=h=>{const t=h.reduce((e,i)=>{var n;return Di(e,((n=i.getGeometry())==null?void 0:n.getExtent())??[])},_t())??null;return t&&!Oi(t)?t:null},Js="olcOverlayLayerGroup";class tr extends Jn{constructor(e,i={}){const n=i[Bt.LayerUid]||Js;super(e,n);le(this,"featureSelectedId","olcOverlayLayerFeatureSelected");le(this,"featuresPropertyChangedId","olcOverlayLayerFeaturePropertyChanged");const s=i.position??20;this.addLayerGroup(n,s),this.addOverlayLayerObservables()}get featuresSelected(){return he(this.map,this.getObservableName(this.featureSelectedId))}get featuresPropertyChanged(){return he(this.map,this.getObservableName(this.featuresPropertyChangedId))}getVectorLayer(e){const i=super.getLayer(e);return i instanceof Fs?i:null}getVectorSource(e){const i=this.getVectorLayer(e);return i===null?null:i.getSource()}getEndVectorSource(e){const i=this.getVectorSource(e);return Hs(i,"source")?i.getSource():i}addFeatures(e,i){const n=this.getEndVectorSource(e);!n||!i.length||(this.removeFeatures(e,i),n.addFeatures(i))}removeFeatures(e,i){const n=this.getEndVectorSource(e);!n||!i.length||i.forEach(s=>{n.hasFeature(s)&&n.removeFeature(s)})}setFeatures(e,i){const n=this.getEndVectorSource(e);n&&(n.clear(),n.addFeatures(i))}getLayerFeaturesExtent(e){var i;return Zs(((i=this.getFeaturesCollection(e))==null?void 0:i.getArray())||[])}getFeaturesExtent(){const e=this.layerGroup.getLayers().getArray().reduce((i,n)=>Di(i,this.getLayerFeaturesExtent(n.get(Bt.LayerUid))??[]),_t());return e&&!Oi(e)?e:null}getFeaturesCollection(e){const i=this.getEndVectorSource(e);return(i==null?void 0:i.getFeaturesCollection())||null}emitSelectFeatures(e,i,n){this.featuresSelected.next({[Bt.LayerUid]:e,selected:i,deselected:n})}setFeaturesProperty(e,i,n,s){var r;i.forEach(o=>{o.set(n,s,!0)}),(r=this.getLayer(e))==null||r.changed(),this.featuresPropertyChanged.next({[Bt.LayerUid]:e,propertyKey:n})}getClusterFeatures(e){const i=this.getVectorSource(e);return i?i.getFeatures():null}addOverlayLayerObservables(){he(this.map,this.getObservableName(this.featureSelectedId))||(this.map.set(this.getObservableName(this.featureSelectedId),new Qe),this.map.set(this.getObservableName(this.featuresPropertyChangedId),new Qe))}}export{Wi as F,tr as O,ci as R,Fs as V,ns as a,$s as b,Ds as c,Qs as d,V as e,J as f,ai as i,li as l};
